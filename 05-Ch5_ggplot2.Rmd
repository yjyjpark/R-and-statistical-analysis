
# `ggplot2`에 의한 자료 시각화{#chapter-ggplot2}

자료의 시각화(Visualization)란 자료의 구조를 꿰뚫어 볼 수 있는 명쾌한 그래프를 이용하는 자료 분석방법을 의미한다. 
잘 그려진 그래프는 자료의 모습을 있는 그대로 보여 주는 유일한 분석방법이며, 
다른 어떠한 분석기법에 의한 결과보다도 더 많은 정보를 전달해 줄 수 있는 방법이기도 하다. 
Figure \@ref(fig:barely)은 자료 시각화의 위력을 잘 보여주는 예로서 Cleveland(1993)에 의한 놀라운 발견이다. 
1930년대 초 미네소타 주의 농경학자들이 보리 종류에 따른 수확량의 차이를 알아보기 위한 경작 실험을 실시하였다.
6군데 경작지에 10 종류 보리를 2년간 경작하였는데, Morris 지역만이 1932년의 수확량이 1931년의 수확량
보다 많다는 것을 알 수 있다. 6개 경작지가 모두 근처에 있다는 점을 고려해 보면 유독
Morris 지역에서만 다른 결과가 나왔다는 것이 상당히 의심스럽다고 할 수 있으며, 데이터
가 바뀌었을 가능성을 생각해 볼 수 있는 상황이다.

```{r barely, echo=FALSE, fig.cap = "보리 자료에 대한 다중 패널 점그림"}
library(tidyverse)
data(barley, package="lattice")

barley %>%
  ggplot(mapping=aes(x=yield, y=variety, color=year, shape=year)) +
  geom_point() +
  facet_wrap(~site)
```

자료 시각화에 특히 강점이 있는 R에는 몇 가지의 그래프 작성 시스템이 있다. 함수 `plot()` 등이 속해 있는 
`base graphics`도 그 중 하나인데, 이들 그래프 작성 시스템 중 가장 효과적이고 여러 면에서 우수한 시스템이 바로 `ggplot2`라고 할 수 있다. 
그래프 작성에 일관된 규칙이 있어서 복잡한 상황에서도 쉽게 확장이 가능하다는 것이 큰 장점 중 하나이다.

패키지 `ggplot2`도 core tidyverse에 속해있기 때문에 `library(tidyverse)`를 먼저 실행해 주면 사용할 수 있다.


## `ggplot2` 시작하기

패키지 `ggplot2`에 있는 데이터 프레임 `mpg`의 변수 `displ`과 `hwy`의 관계를 산점도로 나타내보자. 
변수 `displ`은 리터 단위의 배기량이고, `hwy`는 고속도로 연비이다.

```{r first-plot, fig.cap = "ggplot2의 산점도"}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))
```

패키지 `ggplot2`에서 그래프 작성은 함수 `ggplot()`으로 시작한다. 
이 함수는 우선 그래프 작성에 사용되는 데이터를 입력 요소 `data`에서 지정하는데, 
데이터는 반드시 데이터 프레임이어야 한다. 또한 이 함수는 그래프가 작성될 좌표계(coordinate system)를 작성하고,
이어서 작성될 그래프를 기다리는 역할을 한다. 따라서 함수 `ggplot()`만으로는 실질적인
그래프가 작성되지 않는다.

실질적인 그래프는 이어진 함수 `geom_point()`로 작성된다. 패키지 `ggplot2`에서는 하나
또는 여러 개의 레이어(layer)들이 겹쳐져서 그래프가 완성되는데, Figure \@ref(fig:first-plot)에는 점으로 
이루어진 하나의 레이어만이 사용되었다. 레이어를 추가하는 `geom` 함수에는 `geom_point()`
외에도 다양한 함수들이 있으며, 앞으로 계속 소개될 것이다.

또한 `geom` 함수에는 입력 요소 `mapping`이 있는데, 이것은 항상 함수 `aes()`와 함께 사용된다. 
매핑(mapping)은 데이터와 그래프의 시각적 요소(aesthetic)를 서로 연결시키는 것으로, 
함수 `aes()`의 입력 요소 x와 y는 X축과 Y축에 각각의 변수를 연결시키는 역할을 하고 있다.

* `ggplot2`에서 그래프 작성의 최소 요소

패키지 `ggplot2`에서 그래프를 작성하기 위해서는 반드시 따라야 할 법칙이 있다. 
이 법칙은 ‘그래프의 문법’이라고 불리는 것으로서 모든 그래프 작성에서 일정하게 적용되기 때문에 
익숙해지기만 한다면 복잡한 형태의 그래프도 쉽게 작성할 수 있게 된다.
패키지 `ggplot2`에서 그래프를 작성하기 위한 3가지 최소 요소는 `<Data>`, `<Geom_Function>`, 
그리고 `<Mappings>`로써 다음과 같은 형식을 취해야 한다.

```{}
ggplot(data = <Data>) +
  <Geom_FUnction>(mapping = aes(<Mappings>))
```

`<Data>`는 그래프 작성에 사용될 데이터 프레임을 지정하는 것이고, 
`<Geom_Function>`은 geom 함수 중 하나를 지정하는 것으로써 레이어를 작성한다. 
여러 개의 레이어를 겹치기 위해서는 필요한 여러 개의 geom 함수를 덧셈 기호로 연결하면 된다. 
`<Mappings>`는 다양한 시각적 요소(크기, 모양, 색깔 등)와 데이터를 연결하는 것이다.

3가지의 필수 요소 외에도 다양한 그래프를 작성하기 위해서는 몇 가지 기본 요소가 더
필요하다. 앞으로 하나하나 살펴보도록 하겠다.









