<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 장 ggplot2에 의한 자료 시각화 | R과 통계분석</title>
  <meta name="description" content="5 장 ggplot2에 의한 자료 시각화 | R과 통계분석" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="5 장 ggplot2에 의한 자료 시각화 | R과 통계분석" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 장 ggplot2에 의한 자료 시각화 | R과 통계분석" />
  
  
  

<meta name="author" content="박동련" />


<meta name="date" content="2024-06-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter-dplyr.html"/>
<link rel="next" href="ch6.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>소개하기</a></li>
<li class="chapter" data-level="1" data-path="R-start.html"><a href="R-start.html"><i class="fa fa-check"></i><b>1</b> R 시작하기</a>
<ul>
<li class="chapter" data-level="1.1" data-path="R-start.html"><a href="R-start.html#r의-소개"><i class="fa fa-check"></i><b>1.1</b> R의 소개</a></li>
<li class="chapter" data-level="1.2" data-path="R-start.html"><a href="R-start.html#r의-설치"><i class="fa fa-check"></i><b>1.2</b> R의 설치</a></li>
<li class="chapter" data-level="1.3" data-path="R-start.html"><a href="R-start.html#rstudio의-설치-및-r의-실행"><i class="fa fa-check"></i><b>1.3</b> RStudio의 설치 및 R의 실행</a></li>
<li class="chapter" data-level="1.4" data-path="R-start.html"><a href="R-start.html#작업공간"><i class="fa fa-check"></i><b>1.4</b> 작업공간</a></li>
<li class="chapter" data-level="1.5" data-path="R-start.html"><a href="R-start.html#스크립트-파일의-활용"><i class="fa fa-check"></i><b>1.5</b> 스크립트 파일의 활용</a></li>
<li class="chapter" data-level="1.6" data-path="R-start.html"><a href="R-start.html#section-batch"><i class="fa fa-check"></i><b>1.6</b> 일괄처리</a></li>
<li class="chapter" data-level="1.7" data-path="R-start.html"><a href="R-start.html#section-package"><i class="fa fa-check"></i><b>1.7</b> R의 확장: 패키지</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="R-start.html"><a href="R-start.html#패키지의-종류"><i class="fa fa-check"></i><b>1.7.1</b> 패키지의 종류</a></li>
<li class="chapter" data-level="1.7.2" data-path="R-start.html"><a href="R-start.html#패키지의-설치-및-사용"><i class="fa fa-check"></i><b>1.7.2</b> 패키지의 설치 및 사용</a></li>
<li class="chapter" data-level="1.7.3" data-path="R-start.html"><a href="R-start.html#패키지-tidyverse의-소개"><i class="fa fa-check"></i><b>1.7.3</b> 패키지 <code>tidyverse</code>의 소개</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structure.html"><a href="data-structure.html"><i class="fa fa-check"></i><b>2</b> R 데이터 구조</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structure.html"><a href="data-structure.html#벡터"><i class="fa fa-check"></i><b>2.1</b> 벡터</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-structure.html"><a href="data-structure.html#벡터의-기본-특성"><i class="fa fa-check"></i><b>2.1.1</b> 벡터의 기본 특성</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structure.html"><a href="data-structure.html#다양한-형태를-갖는-벡터의-생성"><i class="fa fa-check"></i><b>2.1.2</b> 다양한 형태를 갖는 벡터의 생성</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-structure.html"><a href="data-structure.html#문자열을-위한-함수"><i class="fa fa-check"></i><b>2.1.3</b> 문자열을 위한 함수</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-structure.html"><a href="data-structure.html#벡터의-연산"><i class="fa fa-check"></i><b>2.1.4</b> 벡터의 연산</a></li>
<li class="chapter" data-level="2.1.5" data-path="data-structure.html"><a href="data-structure.html#vector-compare"><i class="fa fa-check"></i><b>2.1.5</b> 벡터의 비교</a></li>
<li class="chapter" data-level="2.1.6" data-path="data-structure.html"><a href="data-structure.html#벡터의-인덱싱"><i class="fa fa-check"></i><b>2.1.6</b> 벡터의 인덱싱</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structure.html"><a href="data-structure.html#요인"><i class="fa fa-check"></i><b>2.2</b> 요인</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-structure.html"><a href="data-structure.html#요인의-기본-특성"><i class="fa fa-check"></i><b>2.2.1</b> 요인의 기본 특성</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-structure.html"><a href="data-structure.html#숫자형-벡터를-요인으로-변환"><i class="fa fa-check"></i><b>2.2.2</b> 숫자형 벡터를 요인으로 변환</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-structure.html"><a href="data-structure.html#날짜"><i class="fa fa-check"></i><b>2.3</b> 날짜</a></li>
<li class="chapter" data-level="2.4" data-path="data-structure.html"><a href="data-structure.html#행렬-및-배열"><i class="fa fa-check"></i><b>2.4</b> 행렬 및 배열</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data-structure.html"><a href="data-structure.html#행렬과-배열의-기본-특성"><i class="fa fa-check"></i><b>2.4.1</b> 행렬과 배열의 기본 특성</a></li>
<li class="chapter" data-level="2.4.2" data-path="data-structure.html"><a href="data-structure.html#행렬의-연산"><i class="fa fa-check"></i><b>2.4.2</b> 행렬의 연산</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="data-structure.html"><a href="data-structure.html#section-dataframe"><i class="fa fa-check"></i><b>2.5</b> 데이터 프레임</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="data-structure.html"><a href="data-structure.html#데이터-프레임의-생성"><i class="fa fa-check"></i><b>2.5.1</b> 데이터 프레임의 생성</a></li>
<li class="chapter" data-level="2.5.2" data-path="data-structure.html"><a href="data-structure.html#데이터-프레임의-인덱싱"><i class="fa fa-check"></i><b>2.5.2</b> 데이터 프레임의 인덱싱</a></li>
<li class="chapter" data-level="2.5.3" data-path="data-structure.html"><a href="data-structure.html#함수-with"><i class="fa fa-check"></i><b>2.5.3</b> 함수 <code>with()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="data-structure.html"><a href="data-structure.html#tibble-개선된-형태의-데이터-프레임"><i class="fa fa-check"></i><b>2.6</b> tibble: 개선된 형태의 데이터 프레임</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="data-structure.html"><a href="data-structure.html#tibble-생성"><i class="fa fa-check"></i><b>2.6.1</b> tibble 생성</a></li>
<li class="chapter" data-level="2.6.2" data-path="data-structure.html"><a href="data-structure.html#tibble과-전통적인-데이터-프레임의-차이"><i class="fa fa-check"></i><b>2.6.2</b> tibble과 전통적인 데이터 프레임의 차이</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="data-structure.html"><a href="data-structure.html#section-list"><i class="fa fa-check"></i><b>2.7</b> 리스트</a></li>
<li class="chapter" data-level="2.8" data-path="data-structure.html"><a href="data-structure.html#연습문제"><i class="fa fa-check"></i><b>2.8</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="데이터-입력.html"><a href="데이터-입력.html"><i class="fa fa-check"></i><b>3</b> 데이터 입력</a>
<ul>
<li class="chapter" data-level="3.1" data-path="데이터-입력.html"><a href="데이터-입력.html#텍스트-파일-불러오기-패키지-readr-함수의-활용"><i class="fa fa-check"></i><b>3.1</b> 텍스트 파일 불러오기: 패키지 <code>readr</code> 함수의 활용</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="데이터-입력.html"><a href="데이터-입력.html#함수-read_table로-데이터-파일-불러오기"><i class="fa fa-check"></i><b>3.1.1</b> 함수 <code>read_table()</code>로 데이터 파일 불러오기</a></li>
<li class="chapter" data-level="3.1.2" data-path="데이터-입력.html"><a href="데이터-입력.html#함수-read_csv로-csv-데이터-파일-불러오기"><i class="fa fa-check"></i><b>3.1.2</b> 함수 <code>read_csv()</code>로 CSV 데이터 파일 불러오기</a></li>
<li class="chapter" data-level="3.1.3" data-path="데이터-입력.html"><a href="데이터-입력.html#함수-read_fwf로-고정-포맷-구조를-갖는-데이터-파일-불러오기"><i class="fa fa-check"></i><b>3.1.3</b> 함수 <code>read_fwf()</code>로 고정 포맷 구조를 갖는 데이터 파일 불러오기</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="데이터-입력.html"><a href="데이터-입력.html#excel-파일-불러오기"><i class="fa fa-check"></i><b>3.2</b> Excel 파일 불러오기</a></li>
<li class="chapter" data-level="3.3" data-path="데이터-입력.html"><a href="데이터-입력.html#sas-데이터-파일-불러오기"><i class="fa fa-check"></i><b>3.3</b> SAS 데이터 파일 불러오기</a></li>
<li class="chapter" data-level="3.4" data-path="데이터-입력.html"><a href="데이터-입력.html#html-테이블-불러오기"><i class="fa fa-check"></i><b>3.4</b> HTML 테이블 불러오기</a></li>
<li class="chapter" data-level="3.5" data-path="데이터-입력.html"><a href="데이터-입력.html#연습문제-1"><i class="fa fa-check"></i><b>3.5</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html"><i class="fa fa-check"></i><b>4</b> <code>dplyr</code>에 의한 데이터 다듬기</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#행을-작업-대상으로-하는-함수"><i class="fa fa-check"></i><b>4.1</b> 행을 작업 대상으로 하는 함수</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#조건에-의한-행-선택-filter"><i class="fa fa-check"></i><b>4.1.1</b> 조건에 의한 행 선택: <code>filter()</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#위치에-의한-행-선택-slice-및-그와-관련된-함수"><i class="fa fa-check"></i><b>4.1.2</b> 위치에 의한 행 선택: <code>slice()</code> 및 그와 관련된 함수</a></li>
<li class="chapter" data-level="4.1.3" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#행의-정렬-arrange"><i class="fa fa-check"></i><b>4.1.3</b> 행의 정렬: <code>arrange()</code></a></li>
<li class="chapter" data-level="4.1.4" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#중복된-행의-제거-distinct"><i class="fa fa-check"></i><b>4.1.4</b> 중복된 행의 제거: <code>distinct()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#열을-작업-대상으로-하는-함수"><i class="fa fa-check"></i><b>4.2</b> 열을 작업 대상으로 하는 함수</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#열의-선택-select"><i class="fa fa-check"></i><b>4.2.1</b> 열의 선택: <code>select()</code></a></li>
<li class="chapter" data-level="4.2.2" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#열-이름-변경-rename과-rename_with"><i class="fa fa-check"></i><b>4.2.2</b> 열 이름 변경: <code>rename()</code>과 <code>rename_with()</code></a></li>
<li class="chapter" data-level="4.2.3" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#열의-위치-변경-relocate"><i class="fa fa-check"></i><b>4.2.3</b> 열의 위치 변경: <code>relocate()</code></a></li>
<li class="chapter" data-level="4.2.4" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#새로운-열의-추가-mutate와-transmute"><i class="fa fa-check"></i><b>4.2.4</b> 새로운 열의 추가: <code>mutate()</code>와 <code>transmute()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#여러-행-자료의-요약-summarise"><i class="fa fa-check"></i><b>4.3</b> 여러 행 자료의 요약: <code>summarise()</code></a></li>
<li class="chapter" data-level="4.4" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#그룹-데이터-프레임"><i class="fa fa-check"></i><b>4.4</b> 그룹 데이터 프레임</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#그룹-데이터-프레임의-생성-group_by"><i class="fa fa-check"></i><b>4.4.1</b> 그룹 데이터 프레임의 생성: <code>group_by()</code></a></li>
<li class="chapter" data-level="4.4.2" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#그룹-데이터-프레임에서-기본-함수들의-작동-방식"><i class="fa fa-check"></i><b>4.4.2</b> 그룹 데이터 프레임에서 기본 함수들의 작동 방식</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#다수의-열을-대상으로-하는-작업-across"><i class="fa fa-check"></i><b>4.5</b> 다수의 열을 대상으로 하는 작업: <code>across()</code></a></li>
<li class="chapter" data-level="4.6" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#행-단위-작업-rowwise"><i class="fa fa-check"></i><b>4.6</b> 행 단위 작업: <code>rowwise()</code></a></li>
<li class="chapter" data-level="4.7" data-path="chapter-dplyr.html"><a href="chapter-dplyr.html#연습문제-2"><i class="fa fa-check"></i><b>4.7</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html"><i class="fa fa-check"></i><b>5</b> <code>ggplot2</code>에 의한 자료 시각화</a>
<ul>
<li class="chapter" data-level="5.1" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#ggplot2-시작하기"><i class="fa fa-check"></i><b>5.1</b> <code>ggplot2</code> 시작하기</a></li>
<li class="chapter" data-level="5.2" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#시각적-요소와의-연결-mapping"><i class="fa fa-check"></i><b>5.2</b> 시각적 요소와의 연결: Mapping</a></li>
<li class="chapter" data-level="5.3" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#그룹별-그래프-작성-facet"><i class="fa fa-check"></i><b>5.3</b> 그룹별 그래프 작성: Facet</a></li>
<li class="chapter" data-level="5.4" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#section-geom"><i class="fa fa-check"></i><b>5.4</b> 기하 객체: Geometric object</a></li>
<li class="chapter" data-level="5.5" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#통계적-변환-statistical-transformation"><i class="fa fa-check"></i><b>5.5</b> 통계적 변환: Statistical transformation</a></li>
<li class="chapter" data-level="5.6" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#위치-조정-position-adjustments"><i class="fa fa-check"></i><b>5.6</b> 위치 조정: Position adjustments</a></li>
<li class="chapter" data-level="5.7" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#좌표계-coordinate-system"><i class="fa fa-check"></i><b>5.7</b> 좌표계: Coordinate system</a></li>
<li class="chapter" data-level="5.8" data-path="chapter-ggplot2.html"><a href="chapter-ggplot2.html#연습문제-3"><i class="fa fa-check"></i><b>5.8</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ch6.html"><a href="ch6.html"><i class="fa fa-check"></i><b>6</b> Tidyverse를 활용한 데이터 다루기</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ch6.html"><a href="ch6.html#tidyr로-tidy-데이터-만들기"><i class="fa fa-check"></i><b>6.1</b> <code>tidyr</code>로 tidy 데이터 만들기</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="ch6.html"><a href="ch6.html#데이터-피벗-pivot_longer와-pivot_wider"><i class="fa fa-check"></i><b>6.1.1</b> 데이터 피벗: <code>pivot_longer()</code>와 <code>pivot_wider()</code></a></li>
<li class="chapter" data-level="6.1.2" data-path="ch6.html"><a href="ch6.html#문자형-열의-결합과-분리-separate와-unite"><i class="fa fa-check"></i><b>6.1.2</b> 문자형 열의 결합과 분리: <code>separate()</code>와 <code>unite()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ch6.html"><a href="ch6.html#dplyr에-의한-데이터-결합"><i class="fa fa-check"></i><b>6.2</b> <code>dplyr</code>에 의한 데이터 결합</a></li>
<li class="chapter" data-level="6.3" data-path="ch6.html"><a href="ch6.html#stringr에-의한-문자-다루기"><i class="fa fa-check"></i><b>6.3</b> <code>stringr</code>에 의한 문자 다루기</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ch6.html"><a href="ch6.html#stringr의-함수"><i class="fa fa-check"></i><b>6.3.1</b> <code>stringr</code>의 함수</a></li>
<li class="chapter" data-level="6.3.2" data-path="ch6.html"><a href="ch6.html#정규-표현식과-stringr의-함수"><i class="fa fa-check"></i><b>6.3.2</b> 정규 표현식과 <code>stringr</code>의 함수</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="ch6.html"><a href="ch6.html#연습문제-4"><i class="fa fa-check"></i><b>6.4</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="chapter-programming.html"><a href="chapter-programming.html"><i class="fa fa-check"></i><b>7</b> R에서의 프로그래밍</a>
<ul>
<li class="chapter" data-level="7.1" data-path="chapter-programming.html"><a href="chapter-programming.html#사용자-정의-함수"><i class="fa fa-check"></i><b>7.1</b> 사용자 정의 함수</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="chapter-programming.html"><a href="chapter-programming.html#함수의-정의"><i class="fa fa-check"></i><b>7.1.1</b> 함수의 정의</a></li>
<li class="chapter" data-level="7.1.2" data-path="chapter-programming.html"><a href="chapter-programming.html#변수"><i class="fa fa-check"></i><b>7.1.2</b> 변수</a></li>
<li class="chapter" data-level="7.1.3" data-path="chapter-programming.html"><a href="chapter-programming.html#변수-지정"><i class="fa fa-check"></i><b>7.1.3</b> 변수 지정</a></li>
<li class="chapter" data-level="7.1.4" data-path="chapter-programming.html"><a href="chapter-programming.html#결과의-출력"><i class="fa fa-check"></i><b>7.1.4</b> 결과의 출력</a></li>
<li class="chapter" data-level="7.1.5" data-path="chapter-programming.html"><a href="chapter-programming.html#유효-범위"><i class="fa fa-check"></i><b>7.1.5</b> 유효 범위</a></li>
<li class="chapter" data-level="7.1.6" data-path="chapter-programming.html"><a href="chapter-programming.html#데이터-프레임-함수"><i class="fa fa-check"></i><b>7.1.6</b> 데이터 프레임 함수</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="chapter-programming.html"><a href="chapter-programming.html#조건-연산"><i class="fa fa-check"></i><b>7.2</b> 조건 연산</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="chapter-programming.html"><a href="chapter-programming.html#함수-if에-의한-조건-연산"><i class="fa fa-check"></i><b>7.2.1</b> 함수 <code>if()</code>에 의한 조건 연산</a></li>
<li class="chapter" data-level="7.2.2" data-path="chapter-programming.html"><a href="chapter-programming.html#함수-ifelse에-의한-조건-연산"><i class="fa fa-check"></i><b>7.2.2</b> 함수 <code>ifelse()</code>에 의한 조건 연산</a></li>
<li class="chapter" data-level="7.2.3" data-path="chapter-programming.html"><a href="chapter-programming.html#함수-switch에-의한-조건-연산"><i class="fa fa-check"></i><b>7.2.3</b> 함수 <code>switch()</code>에 의한 조건 연산</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="chapter-programming.html"><a href="chapter-programming.html#루프-연산"><i class="fa fa-check"></i><b>7.3</b> 루프 연산</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="chapter-programming.html"><a href="chapter-programming.html#for-루프"><i class="fa fa-check"></i><b>7.3.1</b> for 루프</a></li>
<li class="chapter" data-level="7.3.2" data-path="chapter-programming.html"><a href="chapter-programming.html#while-루프"><i class="fa fa-check"></i><b>7.3.2</b> while 루프</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="chapter-programming.html"><a href="chapter-programming.html#함수형-프로그래밍"><i class="fa fa-check"></i><b>7.4</b> 함수형 프로그래밍</a></li>
<li class="chapter" data-level="7.5" data-path="chapter-programming.html"><a href="chapter-programming.html#함수형-프로그래밍으로-행렬과-데이터-프레임-다루기"><i class="fa fa-check"></i><b>7.5</b> 함수형 프로그래밍으로 행렬과 데이터 프레임 다루기</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="chapter-programming.html"><a href="chapter-programming.html#행렬에-함수형-프로그래밍-적용하기"><i class="fa fa-check"></i><b>7.5.1</b> 행렬에 함수형 프로그래밍 적용하기</a></li>
<li class="chapter" data-level="7.5.2" data-path="chapter-programming.html"><a href="chapter-programming.html#데이터-프레임에-함수형-프로그래밍-적용하기"><i class="fa fa-check"></i><b>7.5.2</b> 데이터 프레임에 함수형 프로그래밍 적용하기</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="chapter-programming.html"><a href="chapter-programming.html#purrr에-의한-프로그래밍"><i class="fa fa-check"></i><b>7.6</b> <code>purrr</code>에 의한 프로그래밍</a></li>
<li class="chapter" data-level="7.7" data-path="chapter-programming.html"><a href="chapter-programming.html#연습문제-5"><i class="fa fa-check"></i><b>7.7</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chapter-distribution.html"><a href="chapter-distribution.html"><i class="fa fa-check"></i><b>8</b> 확률분포</a>
<ul>
<li class="chapter" data-level="8.1" data-path="chapter-distribution.html"><a href="chapter-distribution.html#r에서의-확률분포-이름"><i class="fa fa-check"></i><b>8.1</b> R에서의 확률분포 이름</a></li>
<li class="chapter" data-level="8.2" data-path="chapter-distribution.html"><a href="chapter-distribution.html#연속형-확률분포"><i class="fa fa-check"></i><b>8.2</b> 연속형 확률분포</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="chapter-distribution.html"><a href="chapter-distribution.html#정규분포"><i class="fa fa-check"></i><b>8.2.1</b> 정규분포</a></li>
<li class="chapter" data-level="8.2.2" data-path="chapter-distribution.html"><a href="chapter-distribution.html#지수분포"><i class="fa fa-check"></i><b>8.2.2</b> 지수분포</a></li>
<li class="chapter" data-level="8.2.3" data-path="chapter-distribution.html"><a href="chapter-distribution.html#균등분포"><i class="fa fa-check"></i><b>8.2.3</b> 균등분포</a></li>
<li class="chapter" data-level="8.2.4" data-path="chapter-distribution.html"><a href="chapter-distribution.html#t-분포"><i class="fa fa-check"></i><b>8.2.4</b> t-분포</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="chapter-distribution.html"><a href="chapter-distribution.html#이산형-분포"><i class="fa fa-check"></i><b>8.3</b> 이산형 분포</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="chapter-distribution.html"><a href="chapter-distribution.html#베르누이-분포와-이항분포"><i class="fa fa-check"></i><b>8.3.1</b> 베르누이 분포와 이항분포</a></li>
<li class="chapter" data-level="8.3.2" data-path="chapter-distribution.html"><a href="chapter-distribution.html#포아송-분포"><i class="fa fa-check"></i><b>8.3.2</b> 포아송 분포</a></li>
<li class="chapter" data-level="8.3.3" data-path="chapter-distribution.html"><a href="chapter-distribution.html#초기하분포"><i class="fa fa-check"></i><b>8.3.3</b> 초기하분포</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="chapter-distribution.html"><a href="chapter-distribution.html#모의실험"><i class="fa fa-check"></i><b>8.4</b> 모의실험</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chapter-EDA.html"><a href="chapter-EDA.html"><i class="fa fa-check"></i><b>9</b> 자료 탐색</a>
<ul>
<li class="chapter" data-level="9.1" data-path="chapter-EDA.html"><a href="chapter-EDA.html#일변량-범주형-자료-탐색"><i class="fa fa-check"></i><b>9.1</b> 일변량 범주형 자료 탐색</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="chapter-EDA.html"><a href="chapter-EDA.html#막대그래프"><i class="fa fa-check"></i><b>9.1.1</b> 막대그래프</a></li>
<li class="chapter" data-level="9.1.2" data-path="chapter-EDA.html"><a href="chapter-EDA.html#파이그래프"><i class="fa fa-check"></i><b>9.1.2</b> 파이그래프</a></li>
<li class="chapter" data-level="9.1.3" data-path="chapter-EDA.html"><a href="chapter-EDA.html#cleveland의-점그래프"><i class="fa fa-check"></i><b>9.1.3</b> Cleveland의 점그래프</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="chapter-EDA.html"><a href="chapter-EDA.html#이변량-및-다변량-범주형-자료-탐색"><i class="fa fa-check"></i><b>9.2</b> 이변량 및 다변량 범주형 자료 탐색</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="chapter-EDA.html"><a href="chapter-EDA.html#분할표-작성"><i class="fa fa-check"></i><b>9.2.1</b> 분할표 작성</a></li>
<li class="chapter" data-level="9.2.2" data-path="chapter-EDA.html"><a href="chapter-EDA.html#이변량-및-다변량-범주형-자료를-위한-그래프"><i class="fa fa-check"></i><b>9.2.2</b> 이변량 및 다변량 범주형 자료를 위한 그래프</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="chapter-EDA.html"><a href="chapter-EDA.html#일변량-연속형-자료-탐색"><i class="fa fa-check"></i><b>9.3</b> 일변량 연속형 자료 탐색</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="chapter-EDA.html"><a href="chapter-EDA.html#줄기-잎-그림"><i class="fa fa-check"></i><b>9.3.1</b> 줄기-잎 그림</a></li>
<li class="chapter" data-level="9.3.2" data-path="chapter-EDA.html"><a href="chapter-EDA.html#section-boxplot"><i class="fa fa-check"></i><b>9.3.2</b> 상자그림</a></li>
<li class="chapter" data-level="9.3.3" data-path="chapter-EDA.html"><a href="chapter-EDA.html#히스토그램"><i class="fa fa-check"></i><b>9.3.3</b> 히스토그램</a></li>
<li class="chapter" data-level="9.3.4" data-path="chapter-EDA.html"><a href="chapter-EDA.html#section-prob-density"><i class="fa fa-check"></i><b>9.3.4</b> 확률밀도함수 그래프</a></li>
<li class="chapter" data-level="9.3.5" data-path="chapter-EDA.html"><a href="chapter-EDA.html#기타-유용한-그래프"><i class="fa fa-check"></i><b>9.3.5</b> 기타 유용한 그래프</a></li>
<li class="chapter" data-level="9.3.6" data-path="chapter-EDA.html"><a href="chapter-EDA.html#일변량-연속형-자료의-요약통계"><i class="fa fa-check"></i><b>9.3.6</b> 일변량 연속형 자료의 요약통계</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="chapter-EDA.html"><a href="chapter-EDA.html#이변량-연속형-자료-탐색"><i class="fa fa-check"></i><b>9.4</b> 이변량 연속형 자료 탐색</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="chapter-EDA.html"><a href="chapter-EDA.html#연속형-변수의-분포를-비교하기-위한-그래프"><i class="fa fa-check"></i><b>9.4.1</b> 연속형 변수의 분포를 비교하기 위한 그래프</a></li>
<li class="chapter" data-level="9.4.2" data-path="chapter-EDA.html"><a href="chapter-EDA.html#연속형-변수의-관계-탐색을-위한-그래프"><i class="fa fa-check"></i><b>9.4.2</b> 연속형 변수의 관계 탐색을 위한 그래프</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="chapter-EDA.html"><a href="chapter-EDA.html#연습문제-6"><i class="fa fa-check"></i><b>9.5</b> 연습문제</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html"><i class="fa fa-check"></i>부록</a>
<ul>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#r과-통계분석-연습문제-해답"><i class="fa fa-check"></i>‘R과 통계분석’ 연습문제 해답</a>
<ul>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#장"><i class="fa fa-check"></i>2장</a></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#장-1"><i class="fa fa-check"></i>3장</a></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#장-2"><i class="fa fa-check"></i>4장</a></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#장-3"><i class="fa fa-check"></i>5장</a></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#장-4"><i class="fa fa-check"></i>6장</a></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#장-5"><i class="fa fa-check"></i>7장</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="부록.html"><a href="부록.html#참고문헌"><i class="fa fa-check"></i>참고문헌</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R과 통계분석</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="chapter-ggplot2" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5 장</span> <code>ggplot2</code>에 의한 자료 시각화<a href="chapter-ggplot2.html#chapter-ggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>자료의 시각화(Visualization)란 자료의 구조를 꿰뚫어 볼 수 있는 명쾌한 그래프를 이용하는 자료 분석방법을 의미한다.
잘 그려진 그래프는 자료의 모습을 있는 그대로 보여 주는 유일한 분석방법이며,
다른 어떠한 분석기법에 의한 결과보다도 더 많은 정보를 전달해 줄 수 있는 방법이기도 하다.
그림 <a href="chapter-ggplot2.html#fig:barely">5.1</a>은 자료 시각화의 위력을 잘 보여주는 예로서 <span class="citation">Cleveland (1993)</span> 에 의한 놀라운 발견이다.
1930년대 초 미네소타 주의 농경학자들이 보리 종류에 따른 수확량의 차이를 알아보기 위한 경작 실험을 실시하였다.
6군데 경작지에 10종류 보리를 2년간 경작하였는데, Morris 지역만이 1932년의 수확량이 1931년의 수확량
보다 많다는 것을 알 수 있다. 6개 경작지가 모두 근처에 있다는 점을 고려해 보면 유독
Morris 지역에서만 다른 결과가 나왔다는 것이 상당히 의심스럽다고 할 수 있으며,
데이터가 바뀌었을 가능성을 생각해 볼 수 있는 상황이다.</p>
<div class="figure"><span style="display:block;" id="fig:barely"></span>
<img src="_main_files/figure-html/barely-1.png" alt="보리 자료에 대한 다중 패널 점그림" width="672" />
<p class="caption">
그림 5.1: 보리 자료에 대한 다중 패널 점그림
</p>
</div>
<p>자료 시각화에 특히 강점이 있는 R에는 몇 가지의 그래프 작성 시스템이 있다. 함수 <code>plot()</code> 등이 속해 있는
<code>base graphics</code>도 그 중 하나인데, 이들 그래프 작성 시스템 중 가장 효과적이고 여러 면에서 우수한 시스템이 바로 <code>ggplot2</code>라고 할 수 있다.
그래프 작성에 일관된 규칙이 있어서 복잡한 상황에서도 쉽게 확장이 가능하다는 것이 큰 장점 중 하나이다.</p>
<p>패키지 <code>ggplot2</code>도 core tidyverse에 속해있기 때문에 <code>library(tidyverse)</code>를 먼저 실행해 주면 사용할 수 있다.</p>
<div id="ggplot2-시작하기" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> <code>ggplot2</code> 시작하기<a href="chapter-ggplot2.html#ggplot2-시작하기" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>패키지 <code>ggplot2</code>에 있는 데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 관계를 산점도로 나타내보자.
변수 <code>displ</code>은 리터 단위의 배기량이고, <code>hwy</code>는 고속도로 연비이다.</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="chapter-ggplot2.html#cb557-1" tabindex="-1"></a>mpg</span>
<span id="cb557-2"><a href="chapter-ggplot2.html#cb557-2" tabindex="-1"></a><span class="do">## # A tibble: 234 × 11</span></span>
<span id="cb557-3"><a href="chapter-ggplot2.html#cb557-3" tabindex="-1"></a><span class="do">##    manufacturer model      displ  year   cyl trans drv     cty   hwy fl    class</span></span>
<span id="cb557-4"><a href="chapter-ggplot2.html#cb557-4" tabindex="-1"></a><span class="do">##    &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;</span></span>
<span id="cb557-5"><a href="chapter-ggplot2.html#cb557-5" tabindex="-1"></a><span class="do">##  1 audi         a4           1.8  1999     4 auto… f        18    29 p     comp…</span></span>
<span id="cb557-6"><a href="chapter-ggplot2.html#cb557-6" tabindex="-1"></a><span class="do">##  2 audi         a4           1.8  1999     4 manu… f        21    29 p     comp…</span></span>
<span id="cb557-7"><a href="chapter-ggplot2.html#cb557-7" tabindex="-1"></a><span class="do">##  3 audi         a4           2    2008     4 manu… f        20    31 p     comp…</span></span>
<span id="cb557-8"><a href="chapter-ggplot2.html#cb557-8" tabindex="-1"></a><span class="do">##  4 audi         a4           2    2008     4 auto… f        21    30 p     comp…</span></span>
<span id="cb557-9"><a href="chapter-ggplot2.html#cb557-9" tabindex="-1"></a><span class="do">##  5 audi         a4           2.8  1999     6 auto… f        16    26 p     comp…</span></span>
<span id="cb557-10"><a href="chapter-ggplot2.html#cb557-10" tabindex="-1"></a><span class="do">##  6 audi         a4           2.8  1999     6 manu… f        18    26 p     comp…</span></span>
<span id="cb557-11"><a href="chapter-ggplot2.html#cb557-11" tabindex="-1"></a><span class="do">##  7 audi         a4           3.1  2008     6 auto… f        18    27 p     comp…</span></span>
<span id="cb557-12"><a href="chapter-ggplot2.html#cb557-12" tabindex="-1"></a><span class="do">##  8 audi         a4 quattro   1.8  1999     4 manu… 4        18    26 p     comp…</span></span>
<span id="cb557-13"><a href="chapter-ggplot2.html#cb557-13" tabindex="-1"></a><span class="do">##  9 audi         a4 quattro   1.8  1999     4 auto… 4        16    25 p     comp…</span></span>
<span id="cb557-14"><a href="chapter-ggplot2.html#cb557-14" tabindex="-1"></a><span class="do">## 10 audi         a4 quattro   2    2008     4 manu… 4        20    28 p     comp…</span></span>
<span id="cb557-15"><a href="chapter-ggplot2.html#cb557-15" tabindex="-1"></a><span class="do">## # ℹ 224 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="chapter-ggplot2.html#cb558-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb558-2"><a href="chapter-ggplot2.html#cb558-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:first-plot"></span>
<img src="_main_files/figure-html/first-plot-1.png" alt="ggplot2의 산점도" width="576" />
<p class="caption">
그림 5.2: ggplot2의 산점도
</p>
</div>
<p>패키지 <code>ggplot2</code>에서 그래프 작성은 함수 <code>ggplot()</code>으로 시작한다.
이 함수는 우선 그래프 작성에 사용되는 데이터를 입력 요소 <code>data</code>에서 지정하는데,
데이터는 반드시 데이터 프레임이어야 한다. 또한 이 함수는 그래프가 작성될 좌표계(coordinate system)를 작성하고,
이어서 작성될 그래프를 기다리는 역할을 한다. 따라서 함수 <code>ggplot()</code>만으로는 실질적인
그래프가 작성되지 않는다.</p>
<p>실질적인 그래프는 이어진 함수 <code>geom_point()</code>로 작성된다. 패키지 <code>ggplot2</code>에서는 하나
또는 여러 개의 레이어(layer)들이 겹쳐져서 그래프가 완성되는데, 그림 <a href="chapter-ggplot2.html#fig:first-plot">5.2</a>에는 점으로
이루어진 하나의 레이어만이 사용되었다. 레이어를 추가하는 <code>geom</code> 함수에는 <code>geom_point()</code>
외에도 다양한 함수들이 있으며, 앞으로 계속 소개될 것이다.</p>
<p>또한 <code>geom</code> 함수에는 입력 요소 <code>mapping</code>이 있는데, 이것은 항상 함수 <code>aes()</code>와 함께 사용된다.
매핑(mapping)은 데이터와 그래프의 시각적 요소(aesthetic)를 서로 연결시키는 것으로, 위의 예에서 함수 <code>geom_point()</code>의 <code>x</code>와 <code>y</code>는 점의 위치 (x, y)를 변수 <code>displ</code>과 <code>hwy</code>의 값으로 지정하게 된다.</p>
<ul>
<li><code>ggplot2</code>에서 그래프 작성의 최소 요소</li>
</ul>
<p>패키지 <code>ggplot2</code>에서 그래프를 작성하기 위해서는 반드시 따라야 할 법칙이 있다.
Grammar of graphics라고 불리는 이 법칙은 모든 그래프 작성에서 일정하게 적용되기 때문에
익숙해지기만 한다면 복잡한 형태의 그래프도 쉽게 작성할 수 있게 된다.
패키지 <code>ggplot2</code>에서 그래프를 작성하기 위한 3가지 최소 요소는 <code>&lt;Data&gt;</code>, <code>&lt;Geom_Function&gt;</code>,
그리고 <code>&lt;Mappings&gt;</code>로써 다음과 같은 형식을 취해야 한다.</p>
<pre><code>ggplot(data = &lt;Data&gt;) +
  &lt;Geom_FUnction&gt;(mapping = aes(&lt;Mappings&gt;))</code></pre>
<p><code>&lt;Data&gt;</code>는 그래프 작성에 사용될 데이터 프레임을 지정하는 것이고,
<code>&lt;Geom_Function&gt;</code>은 geom 함수 중 하나를 지정하는 것으로써 레이어를 작성한다.
여러 개의 레이어를 겹치기 위해서는 필요한 여러 개의 geom 함수를 덧셈 기호로 연결하면 된다.
<code>&lt;Mappings&gt;</code>는 다양한 시각적 요소(크기, 모양, 색깔 등)와 데이터를 연결하는 것이다.</p>
<p>3가지의 필수 요소 외에도 다양한 그래프를 작성하기 위해서는 몇 가지 기본 요소가 더
필요하다. 앞으로 하나하나 살펴보도록 하겠다.</p>
</div>
<div id="시각적-요소와의-연결-mapping" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> 시각적 요소와의 연결: Mapping<a href="chapter-ggplot2.html#시각적-요소와의-연결-mapping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>그림 <a href="chapter-ggplot2.html#fig:first-plot">5.2</a>와 같은 산점도를 작성하기 위해서는 점들의 위치와 더불어 점의 크기, 모양 및
색깔 등을 결정해야 하는데, 이러한 특성들은 우리가 그래프를 시각적으로 인식할 때 필요한 시각적 요소(aesthetic)라고 할 수 있다.
시각적 요소들은 데이터와 연동되어 결정되기도 하지만, 어떤 경우에는 데이터와 관계 없이 일정한 값을 가지기도 한다.</p>
<p>시각적 요소들을 데이터와 연동하여 결정하는 것을 매핑(mapping)이라고 하는데, 함수 <code>aes()</code> 안에서 연결하게 된다.
그림 <a href="chapter-ggplot2.html#fig:first-plot">5.2</a>에서는 점의 위치인 <code>x</code>와 <code>y</code>가 변수 <code>displ</code>과 <code>hwy</code>와 매핑이 되었다.
점의 크기, 모양 또는 색깔과 같은 시각적 요소들을 변수와 연결하여 표현을 한다면, 기존의 그래프에 다른 변수의 정보를 추가할 수 있다.</p>
<p>시각적 요소들을 사용자가 일정한 값으로 지정하는 것은 세팅(setting)이라고 하는데, 함수 <code>aes()</code> 밖에서 지정하게 된다.
예를 들어, 변수 <code>displ</code>과 <code>hwy</code>의 산점도를 작성하되 점을 모두 빨간색으로 나타낸다고 하면, 점의 위치는 매핑으로 결정하게 되고, 점의 색은 세팅으로 결정하는 것이다.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="chapter-ggplot2.html#cb560-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb560-2"><a href="chapter-ggplot2.html#cb560-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy), </span>
<span id="cb560-3"><a href="chapter-ggplot2.html#cb560-3" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-6"></span>
<img src="_main_files/figure-html/5-6-1.png" alt="시각적 요소 `color`의 사용자 지정" width="576" />
<p class="caption">
그림 5.3: 시각적 요소 <code>color</code>의 사용자 지정
</p>
</div>
<p><span class="math inline">\(\bullet\)</span> 시각적 요소 <code>color</code>의 매핑</p>
<p><code>mpg</code>에 있는 변수 <code>displ</code>과 <code>hwy</code>의 산점도에 시각적 요소 <code>color</code>의 매핑으로 다른 변수의 정보를 추가해 보자.
우선 <code>color</code>에 문자형 변수인 <code>drv</code>를 매핑해 보자.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="chapter-ggplot2.html#cb561-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb561-2"><a href="chapter-ggplot2.html#cb561-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> drv))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:color-mapping-1"></span>
<img src="_main_files/figure-html/color-mapping-1-1.png" alt="시각적 요소 `color`에 문자형 변수 매핑" width="576" />
<p class="caption">
그림 5.4: 시각적 요소 <code>color</code>에 문자형 변수 매핑
</p>
</div>
<p>변수 <code>drv</code>의 값에 따라 다른 색이 사용되었고, 따라서 각 점이 어떤 <code>drv</code>에 속하는지 바로 알 수 있게 되었다.
사용된 색깔에 대한 범례는 자동으로 추가된다.</p>
<p>이번에는 <code>color</code>에 숫자형 변수인 <code>cyl</code>을 매핑해 보자.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="chapter-ggplot2.html#cb562-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb562-2"><a href="chapter-ggplot2.html#cb562-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> cyl))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:color-mapping-2"></span>
<img src="_main_files/figure-html/color-mapping-2-1.png" alt="시각적 요소 `color`에 숫자형 변수 매핑" width="576" />
<p class="caption">
그림 5.5: 시각적 요소 <code>color</code>에 숫자형 변수 매핑
</p>
</div>
<p>숫자형 변수를 <code>color</code>에 매핑하면, 범주형 변수와는 다른 방식으로 범례가 작성되는 것을 볼 수 있다.</p>
<p>시각적 요소에 범주의 개수가 너무 많은 변수를 매핑하게 되면, 대부분 좋지 않은 그래프를 작성하게 된다.
<code>color</code>에 변수 <code>class</code>를 매핑해 보자.
변수 <code>class</code>는 7개 범주를 갖고 있는 문자형 변수이다.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="chapter-ggplot2.html#cb563-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb563-2"><a href="chapter-ggplot2.html#cb563-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:color-mapping-3"></span>
<img src="_main_files/figure-html/color-mapping-3-1.png" alt="시각적 요소 `color`의 매핑" width="576" />
<p class="caption">
그림 5.6: 시각적 요소 <code>color</code>의 매핑
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:color-mapping-3">5.6</a>에서 볼 수 있듯이, <code>class</code>의 범주 개수가 지나치게 많아서 정보 파악이 어려운 그래프가 작성되었다.</p>
<p><span class="math inline">\(\bullet\)</span> 시각적 요소 <code>shape</code>의 매핑</p>
<p>시각적 요소 <code>shape</code>는 점의 모양에 대한 것이며, 문자형이나 요인이 매핑 가능한 변수 유형이 된다.
변수 <code>displ</code>과 <code>hwy</code>의 산점도에 점의 모양을 변수 <code>drv</code>와 연결하여 표현해 보자.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="chapter-ggplot2.html#cb564-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb564-2"><a href="chapter-ggplot2.html#cb564-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">shape =</span> drv))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-4-a"></span>
<img src="_main_files/figure-html/5-4-a-1.png" alt="시각적 요소 `shape`의 매핑" width="576" />
<p class="caption">
그림 5.7: 시각적 요소 <code>shape</code>의 매핑
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-4-a">5.7</a>에는 세 가지 모양의 점이 사용되었으나, 모양 차이가 쉽게 느껴지지 않고 있다.
이런 경우에는 다른 시각적 요소를 <code>drv</code>에 함께 매핑하여 작성한 그림 <a href="chapter-ggplot2.html#fig:5-4-b">5.8</a>가 좋은 대안이 될 수 있다.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="chapter-ggplot2.html#cb565-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb565-2"><a href="chapter-ggplot2.html#cb565-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">shape =</span> drv, <span class="at">color =</span> drv))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-4-b"></span>
<img src="_main_files/figure-html/5-4-b-1.png" alt="시각적 요소 `shape`의 매핑" width="576" />
<p class="caption">
그림 5.8: 시각적 요소 <code>shape</code>의 매핑
</p>
</div>
<p><code>shape</code>에 숫자형 변수를 매핑하면 다음과 같이 오류가 발생하게 된다.</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="chapter-ggplot2.html#cb566-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb566-2"><a href="chapter-ggplot2.html#cb566-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">shape =</span> cyl))</span>
<span id="cb566-3"><a href="chapter-ggplot2.html#cb566-3" tabindex="-1"></a><span class="do">## Error in `geom_point()`:</span></span>
<span id="cb566-4"><a href="chapter-ggplot2.html#cb566-4" tabindex="-1"></a><span class="do">## ! Problem while computing aesthetics.</span></span>
<span id="cb566-5"><a href="chapter-ggplot2.html#cb566-5" tabindex="-1"></a><span class="do">## ℹ Error occurred in the 1st layer.</span></span>
<span id="cb566-6"><a href="chapter-ggplot2.html#cb566-6" tabindex="-1"></a><span class="do">## Caused by error in `scale_f()`:</span></span>
<span id="cb566-7"><a href="chapter-ggplot2.html#cb566-7" tabindex="-1"></a><span class="do">## ! A continuous variable cannot be mapped to the shape aesthetic.</span></span>
<span id="cb566-8"><a href="chapter-ggplot2.html#cb566-8" tabindex="-1"></a><span class="do">## ℹ Choose a different aesthetic or use `scale_shape_binned()`.</span></span></code></pre></div>
<p><span class="math inline">\(\bullet\)</span> 시각적 요소 <code>size</code>의 매핑</p>
<p>시각적 요소 <code>size</code>는 점의 크기에 대한 것이며, 매핑은 연속형 변수를 사용하는 것이 좋다.
변수 <code>displ</code>과 <code>hwy</code>의 산점도에 점의 크기를 변수 <code>cyl</code>과 연결해 보자.
변수 <code>cyl</code>의 값에 따라 점의 크기가 조절이 되는 것을 알 수 있지만,
범주의 개수가 너무 많아서 점의 크기를 구분하는 것이 거의 불가능한 그래프가 작성되었다.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="chapter-ggplot2.html#cb567-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb567-2"><a href="chapter-ggplot2.html#cb567-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">size =</span> cyl))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-5"></span>
<img src="_main_files/figure-html/5-5-1.png" alt="시각적 요소 `size`의 매핑" width="576" />
<p class="caption">
그림 5.9: 시각적 요소 <code>size</code>의 매핑
</p>
</div>
<p>범주형 변수도 <code>shape</code>에 매핑하는 것은 가능하지만, 정보를 왜곡시킬 수 있기 때문에 사용하지 않는 것이 좋을 것이다.
예를 들어 문자형 변수 <code>drv</code>를 <code>shape</code>에 매핑해 보자.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="chapter-ggplot2.html#cb568-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb568-2"><a href="chapter-ggplot2.html#cb568-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">size =</span> drv))</span>
<span id="cb568-3"><a href="chapter-ggplot2.html#cb568-3" tabindex="-1"></a><span class="do">## Warning: Using size for a discrete variable is not advised.</span></span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-5-a"></span>
<img src="_main_files/figure-html/5-5-a-1.png" alt="시각적 요소 `size`의 매핑" width="576" />
<p class="caption">
그림 5.10: 시각적 요소 <code>size</code>의 매핑
</p>
</div>
<p>여러 시각적 요소를 동시에 사용해야 하는 경우가 많이 있다. 이런 경우에, 여러 시각적
요소들을 모두 변수들과 매핑을 하게 되면 그래프에 너무 많은 정보를 표현하게 될 가능성
이 있으며, 오히려 그래프의 의미가 모호해질 수 있다는 점에 유의해야 할 것이다.
그림 <a href="chapter-ggplot2.html#fig:5-8">5.11</a>은 세 가지 시각적 요소를 모두 다른 변수와 연결하여 작성한 것이다.
좋지 않은 그래프의 작성 예가 된다.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="chapter-ggplot2.html#cb569-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb569-2"><a href="chapter-ggplot2.html#cb569-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> class, <span class="at">shape =</span> drv, <span class="at">size =</span> cyl))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-8"></span>
<img src="_main_files/figure-html/5-8-1.png" alt="여러 시각적 요소를 동시에 매핑을 실시한 그래프" width="672" />
<p class="caption">
그림 5.11: 여러 시각적 요소를 동시에 매핑을 실시한 그래프
</p>
</div>
<p><span class="math inline">\(\bullet\)</span> 시각적 요소의 세팅</p>
<p>시각적 요소를 데이터와 연결하여 결정하지 않고 사용자가 값을 직접 지정하는 것도 가능하다.
시각적 요소의 값을 사용자가 지정하기 위해서는 <code>color</code>, <code>shape</code>, <code>size</code> 등을 함수 <code>aes()</code>의 밖으로 빼내서 <code>geom</code> 함수의 입력 요소로 사용해야 한다.
각 시각적 요소에 지정되는 값은 다음의 규칙에 따른다.</p>
<ol style="list-style-type: decimal">
<li><p><code>color</code>: 색 이름 문자열 지정. 657개의 색 이름은 함수 <code>colors()</code>를 실행하면 확인할 수 있다.</p></li>
<li><p><code>size</code>: 점 크기를 mm 단위로 지정</p></li>
<li><p><code>shape</code>: 점의 형태를 나타내는 0~25 사이의 숫자. 각 숫자에 대응되는 점의 형태는
그림 <a href="chapter-ggplot2.html#fig:shape">5.12</a>에서 볼 수 있다. 숫자 0~14로 지정되는 속이 비어 있는 도형의 선 색깔과
숫자 15~20으로 지정되는 도형의 색깔은 <code>color</code>로 지정하고, 숫자 21~25로 표현되는
도형의 테두리 선 색깔은 <code>color</code>로, 내부를 채우는 색깔은 <code>fill</code>로 각각 지정한다.</p></li>
</ol>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:shape"></span>
<img src="Figure/shape.png" alt="시각적 요소 shape의 지정에 사용 가능한 숫자와 대응되는 점 형태" width="348" />
<p class="caption">
그림 5.12: 시각적 요소 shape의 지정에 사용 가능한 숫자와 대응되는 점 형태
</p>
</div>
<p>여러 시각적 요소의 값을 사용자가 동시에 지정하여 사용해야 하는 경우도 많이 있다.
그림 <a href="chapter-ggplot2.html#fig:5-9">5.13</a>는 점의 크기와 모양, 색깔을 모두 사용자가 지정한 그래프이다.
입력 요소 <code>stroke</code>는 <code>shape</code>가 21~25의 값으로 표현되는 점들의 테두리 선 두께를 조절하는 요소이다.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="chapter-ggplot2.html#cb570-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb570-2"><a href="chapter-ggplot2.html#cb570-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy), </span>
<span id="cb570-3"><a href="chapter-ggplot2.html#cb570-3" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb570-4"><a href="chapter-ggplot2.html#cb570-4" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">stroke =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-9"></span>
<img src="_main_files/figure-html/5-9-1.png" alt="여러 시각적 요소를 동시에 지정한 그래프" width="576" />
<p class="caption">
그림 5.13: 여러 시각적 요소를 동시에 지정한 그래프
</p>
</div>
<p>지금까지 살펴본 바에 의하면 시각적 요소를 변수와 매핑을 하고자 한다면 함수 <code>aes()</code> 안에서 변수와 연결해야 하고,
사용자가 값을 직접 지정하고자 한다면 함수 <code>aes()</code> 밖에서 원하는 값을 지정해야 한다. 그런데 만일 함수 <code>aes()</code> 안에서 시각적 요소의 특정 값을 사용자가 직접 지정하면 어떤 결과가 나올 것인가?
그림 <a href="chapter-ggplot2.html#fig:5-10">5.14</a>은 함수 <code>aes()</code> 안에서 시각적 요소 <code>color</code>에 <code>"blue"</code>를 지정했을 때의 결과이다.
함수 <code>aes()</code> 안에 <code>color</code>가 입력되면 그것은 매핑으로 인식되는데,
매핑은 변수와 연결되는 것이므로 특정 하나의 값과는 매핑이 성립되지 않는다.
따라서 <code>"blue"</code> 하나의 값만을 갖는 새로운 변수를 스스로 만들고, 그 변수와 <code>color</code>를 매핑하게 된다.
사용된 점 색깔은 하나의 값만이 있는 변수에 <code>color</code>를 매핑할 경우 디폴트로 사용되는 색깔이다.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="chapter-ggplot2.html#cb571-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb571-2"><a href="chapter-ggplot2.html#cb571-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-10"></span>
<img src="_main_files/figure-html/5-10-1.png" alt="함수 `aes()` 안에서 `color`를 사용자가 지정한 경우의 그래프" width="576" />
<p class="caption">
그림 5.14: 함수 <code>aes()</code> 안에서 <code>color</code>를 사용자가 지정한 경우의 그래프
</p>
</div>
</div>
<div id="그룹별-그래프-작성-facet" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> 그룹별 그래프 작성: Facet<a href="chapter-ggplot2.html#그룹별-그래프-작성-facet" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>범주형 변수가 다른 변수에 미치는 영향력을 그래프로 확인하는 방법으로써 범주형 변수에 의해 구분되는 그룹별로 그래프를 작성하여 비교하는 것을 생각해 볼 수 있다.
만일 그룹별로 작성된 그래프에 큰 차이가 없다면 범주형 변수의 영향력은 미미한 것으로 볼 수
있을 것이다. 이와 같이 그룹별로 데이터를 구분하여 그래프를 작성하는 것을 faceting이라고 하는데,
패키지 <code>lattice</code>의 <code>Trellis plot</code>과 동일한 개념이 된다.</p>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 함수 <code>facet_wrap()</code>에 의한 faceting</p>
<p>함수 <code>facet_wrap()</code>은 데이터를 구분하려는 변수가 하나인 경우에 주로 사용되며, 사용법은 다음과 같다.</p>
<p><code>facet_wrap(facets, nrow, ncol, scales, dir)</code></p>
<p>여기에서 <code>facets</code>에는 그룹을 구성하는 변수를 지정하는데, 함수 <code>vars()</code>에 나열하면 된다.
<code>nrow</code>와 <code>ncol</code>에는 패널의 행과 열의 개수 지정하며, <code>scales</code>는 각 패널의 XY축 범위를 설정하는 방식을 지정한다.
디폴트 <code>"fixed"</code>는 모든 패널의 XY축 범위를 동일하게 설정하고, <code>"free_x"</code>는 X축의 범위를 각 패널에 따라 다르게 설정하며, <code>"free_y"</code>는 Y축의 범위를 다르게 설정하고, <code>"free"</code>는 XY축의 범위를 다르게 설정하는 것이다.
<code>dir</code>은 그래프의 배치 순서를 지정하는 것인데 디폴트 <code>"h"</code>는 행 방향으로 배치하고, <code>"v"</code>는 열 방향으로 배치하게 된다.</p>
<p>예를 들어 데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 산점도를 변수 <code>class</code>의 범주별로 구분하여 작성해 보자.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="chapter-ggplot2.html#cb572-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg) <span class="sc">+</span></span>
<span id="cb572-2"><a href="chapter-ggplot2.html#cb572-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb572-3"><a href="chapter-ggplot2.html#cb572-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(class))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-11"></span>
<img src="_main_files/figure-html/5-11-1.png" alt="함수 `facet_wrap()`으로 작성된 그래프" width="576" />
<p class="caption">
그림 5.15: 함수 <code>facet_wrap()</code>으로 작성된 그래프
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-11">5.15</a>을 구성하는 7개의 패널 중 <code>2seater</code>라는 제목의 패널에는 적은 개수의 데이터만
해당되는 것을 알 수 있다. 변수 <code>class</code>가 <code>‘2seater’</code>인 케이스를 제거한 후 패널을 2열로 배치하여 작성해 보자.</p>
<p><code>mpg</code>는 pipe 연산자를 통해 <code>filter()</code>를 거쳐 <code>ggplot()</code>의 첫 번째 변수로 입력되었는데, 데이터 프레임이 첫 번째 변수로 입력이 되면 <code>data =</code>은 생략이 가능하다. 또한 <code>geom_point()</code>에 함수 <code>aes()</code>를 첫 번째 변수로 입력하게 되면, <code>mapping =</code>도 생략이 가능하다.
이것은 함수에서 변수를 지정하는 방식에 대한 것으로, 자세한 설명은 <a href="chapter-programming.html#chapter-programming">7</a>장에서 살펴볼 수 있다.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="chapter-ggplot2.html#cb573-1" tabindex="-1"></a>mpg <span class="sc">|&gt;</span>  </span>
<span id="cb573-2"><a href="chapter-ggplot2.html#cb573-2" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">!=</span> <span class="st">&quot;2seater&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb573-3"><a href="chapter-ggplot2.html#cb573-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb573-4"><a href="chapter-ggplot2.html#cb573-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb573-5"><a href="chapter-ggplot2.html#cb573-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(class), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-12"></span>
<img src="_main_files/figure-html/5-12-1.png" alt="`ncol`로 패널 배치 조절" width="576" />
<p class="caption">
그림 5.16: <code>ncol</code>로 패널 배치 조절
</p>
</div>
<p><code>dir</code>의 값 변경해서 패널의 그래프 배치 순서를 다르게 해 보자.</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="chapter-ggplot2.html#cb574-1" tabindex="-1"></a>mpg <span class="sc">|&gt;</span>  </span>
<span id="cb574-2"><a href="chapter-ggplot2.html#cb574-2" tabindex="-1"></a>  <span class="fu">filter</span>(class <span class="sc">!=</span> <span class="st">&quot;2seater&quot;</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb574-3"><a href="chapter-ggplot2.html#cb574-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb574-4"><a href="chapter-ggplot2.html#cb574-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb574-5"><a href="chapter-ggplot2.html#cb574-5" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(class), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">dir =</span> <span class="st">&quot;v&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-13"></span>
<img src="_main_files/figure-html/5-13-1.png" alt="`ncol`과 `dir`로 패널 배치 조절" width="576" />
<p class="caption">
그림 5.17: <code>ncol</code>과 <code>dir</code>로 패널 배치 조절
</p>
</div>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 함수 <code>facet_grid()</code>에 의한 faceting</p>
<p>함수 <code>facet_grid()</code>은 데이터를 구분하려는 변수가 두 개인 경우에 주로 사용되는 함수이지만,
구분하려는 변수가 하나인 경우에도 사용할 수 있다. 사용법은 <code>facet_grid(rows, cols, scales)</code>이며,
<code>rows</code>와 <code>cols</code>에는 패널의 행과 열을 구성하는 변수를 함수 <code>vars()</code>을 이용하여 지정한다.</p>
<p>예를 들어 데이터 프레임 <code>mpg</code>에서 데이터를 변수 <code>drv</code>와 <code>cyl</code>로 구분하여 <code>displ</code>과 <code>hwy</code>의 산점도를 각각 작성해
보자. 단, 변수 <code>drv</code>가 <code>"r"</code>인 데이터와 <code>cyl</code>이 5인 데이터는 제외하자.</p>
<p>함수 <code>ggplot()</code>으로 작성된 그래프를 지금까지는 Plots 창에 바로 나타나게 했지만,
이것을 객체에 할당할 수도 있다.
할당된 ggplot2 객체는 이후에 저장 및 출력 목적으로 사용할 수 있다. 하지만 그래프를 객체에 할당하는 주된 이유는 동일한 내용의 프로그램을 반복해서 입력하지 않기 위함인데, 기본적인 형태의 그래프를 작성하고 그것을 객체에
할당하면 동일한 작업을 반복할 필요 없이 거기에 몇 가지 요소만을 따로 추가하면 수정된 그래프를 작성할 수 있다.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="chapter-ggplot2.html#cb575-1" tabindex="-1"></a>my_plot <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb575-2"><a href="chapter-ggplot2.html#cb575-2" tabindex="-1"></a>  <span class="fu">filter</span>(cyl <span class="sc">!=</span> <span class="dv">5</span>, drv <span class="sc">!=</span> <span class="st">&quot;r&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb575-3"><a href="chapter-ggplot2.html#cb575-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb575-4"><a href="chapter-ggplot2.html#cb575-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code></pre></div>
<p>객체 <code>my_plot</code>에는 변수 <code>drv</code>가 <code>"r"</code>인 데이터와 <code>cyl</code>이 5인 데이터가 제외한 상태에서 두 변수 <code>displ</code>과 <code>hwy</code>의
산점도가 작성되어 있다. 여기에 함수 <code>facet_grid()</code>를 추가하면 우리가 원하는 그래프를 작성할 수 있다. 우선 한 변수만을 사용하여 데이터를 구분하고 그래프를 작성해 보자.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="chapter-ggplot2.html#cb576-1" tabindex="-1"></a>my_plot <span class="sc">+</span> </span>
<span id="cb576-2"><a href="chapter-ggplot2.html#cb576-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(drv))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-14-1"></span>
<img src="_main_files/figure-html/5-14-1-1.png" alt="함수 `facet_grid()`에 의한 한 변수의 faceting" width="576" />
<p class="caption">
그림 5.18: 함수 <code>facet_grid()</code>에 의한 한 변수의 faceting
</p>
</div>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="chapter-ggplot2.html#cb577-1" tabindex="-1"></a>my_plot <span class="sc">+</span> </span>
<span id="cb577-2"><a href="chapter-ggplot2.html#cb577-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(cyl))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-14-2"></span>
<img src="_main_files/figure-html/5-14-2-1.png" alt="함수 `facet_grid()`에 의한 한 변수의 faceting" width="576" />
<p class="caption">
그림 5.19: 함수 <code>facet_grid()</code>에 의한 한 변수의 faceting
</p>
</div>
<p>이제는 두 개 변수를 동시에 사용하여 데이터를 구분하고 그래프를 작성해 보자.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="chapter-ggplot2.html#cb578-1" tabindex="-1"></a>my_plot <span class="sc">+</span> </span>
<span id="cb578-2"><a href="chapter-ggplot2.html#cb578-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(drv), </span>
<span id="cb578-3"><a href="chapter-ggplot2.html#cb578-3" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(cyl))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-15-1"></span>
<img src="_main_files/figure-html/5-15-1-1.png" alt="함수 `facet_grid()`에 의한 두 변수의 faceting" width="576" />
<p class="caption">
그림 5.20: 함수 <code>facet_grid()</code>에 의한 두 변수의 faceting
</p>
</div>
<p>변수 <code>drv</code>의 두 범주와 <code>cyl</code>의 세 범주의 조합으로 구성되는 6개 그룹으로 데이터를 구분하여 각각 작성된 산점도가
그림 <a href="chapter-ggplot2.html#fig:5-15-1">5.20</a>이다. 변수 <code>drv</code>가 행을 구성하고 있고, 변수 <code>cyl</code>이 열을 구성하고 있다.
예를 들어 왼쪽 위 패널은 변수 <code>drv</code>가 <code>“4”</code>이고, 변수 <code>cyl</code>이 <code>4</code>인 자동차들의 <code>displ</code>과 <code>hwy</code>의 산점도이다.</p>
<p>옵션 <code>scales</code>의 값을 변경해서 패널의 XY축 범위를 다르게 설정해 보자.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="chapter-ggplot2.html#cb579-1" tabindex="-1"></a>my_plot <span class="sc">+</span> </span>
<span id="cb579-2"><a href="chapter-ggplot2.html#cb579-2" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">rows =</span> <span class="fu">vars</span>(drv), </span>
<span id="cb579-3"><a href="chapter-ggplot2.html#cb579-3" tabindex="-1"></a>             <span class="at">cols =</span> <span class="fu">vars</span>(cyl),</span>
<span id="cb579-4"><a href="chapter-ggplot2.html#cb579-4" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-15-2"></span>
<img src="_main_files/figure-html/5-15-2-1.png" alt="함수 `facet_grid()`에 의한 두 변수의 faceting" width="576" />
<p class="caption">
그림 5.21: 함수 <code>facet_grid()</code>에 의한 두 변수의 faceting
</p>
</div>
<p>두 변수에 의한 faceting은 함수 <code>facet_wrap()</code>으로도 작성할 수 있다.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="chapter-ggplot2.html#cb580-1" tabindex="-1"></a>my_plot <span class="sc">+</span></span>
<span id="cb580-2"><a href="chapter-ggplot2.html#cb580-2" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(drv, cyl),</span>
<span id="cb580-3"><a href="chapter-ggplot2.html#cb580-3" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-15-3"></span>
<img src="_main_files/figure-html/5-15-3-1.png" alt="함수 `facet_wrap()`에 의한 두 변수의 faceting" width="576" />
<p class="caption">
그림 5.22: 함수 <code>facet_wrap()</code>에 의한 두 변수의 faceting
</p>
</div>
<p>두 변수에 의한 faceting을 함수 <code>facet_wrap()</code>으로 작성하면, 각 패널의 라벨에 범주 값 두 개가 표시되는데, 변수의 이름도 함께 표시하는 것이 변수 조합을 확인하는데 더 편할 것이다.
각 패널의 strip에 표시되는 라벨에 변수 이름도 함께 표시하기 위해서는 옵션 <code>labeller</code>에 <code>label_both</code>를 지정하면 된다.</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="chapter-ggplot2.html#cb581-1" tabindex="-1"></a>my_plot <span class="sc">+</span></span>
<span id="cb581-2"><a href="chapter-ggplot2.html#cb581-2" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(drv, cyl),</span>
<span id="cb581-3"><a href="chapter-ggplot2.html#cb581-3" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">labeller =</span> <span class="st">&quot;label_both&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-15-4"></span>
<img src="_main_files/figure-html/5-15-4-1.png" alt="함수 `facet_wrap()`에 의한 두 변수의 faceting" width="576" />
<p class="caption">
그림 5.23: 함수 <code>facet_wrap()</code>에 의한 두 변수의 faceting
</p>
</div>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 연속형 변수에 의한 faceting</p>
<p>연속형 변수를 이용하여 faceting을 하기 위해서는 우선 연속형 변수를 범주형 변수로 변환시켜야 하는데, 아래의 함수를 이용하면 비교적 쉽게 변환을 할 수 있다.</p>
<ol style="list-style-type: decimal">
<li><p><code>cut_interval(x, n, length)</code>: 벡터 <code>x</code>를 길이가 <code>length</code>인 <code>n</code>개의 구간으로 구분</p></li>
<li><p><code>cut_width(x, width, boundary)</code>: 벡터 <code>x</code>를 길이가 <code>width</code>인 구간으로 구분. 옵션 <code>boundary</code>는 구간의 시작점을 지정.</p></li>
<li><p><code>cut_number(x, n)</code>: 벡터 <code>x</code>를 <code>n</code>개의 구간으로 구분하되 각 구간에 속한 데이터 개수가 비슷해지도록 구분</p></li>
</ol>
<p>예를 들어 데이터 프레임 <code>airquality</code>에서 반응변수 <code>Ozone</code>과 설명변수 <code>Solar.R</code>과 <code>Wind</code>의 관계를 알아보자.
이와 같이 세 연속형 변수의 관계를 알아보는데 적합한 그래프 중 하나는 설명변수 중 하나를 범주형으로 변환하여 faceting하는 것이다.
변수 <code>Wind</code>를 4개의 구간으로 구분하되 각 구간에 속한 데이터의 개수가 비슷해지도록 구분하고,
각 그룹에서 나머지 두 변수의 산점도를 작성해 보자.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="chapter-ggplot2.html#cb582-1" tabindex="-1"></a>air_1 <span class="ot">&lt;-</span> airquality <span class="sc">|&gt;</span> </span>
<span id="cb582-2"><a href="chapter-ggplot2.html#cb582-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wind_d =</span> <span class="fu">cut_number</span>(Wind, <span class="at">n =</span> <span class="dv">4</span>)) </span></code></pre></div>
<p><code>air_1</code>에 추가된 변수 <code>Wind_d</code>는 구간이 범주 이름으로 입력된 요인이라는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="chapter-ggplot2.html#cb583-1" tabindex="-1"></a>air_1 <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb583-2"><a href="chapter-ggplot2.html#cb583-2" tabindex="-1"></a><span class="do">## # A tibble: 153 × 7</span></span>
<span id="cb583-3"><a href="chapter-ggplot2.html#cb583-3" tabindex="-1"></a><span class="do">##    Ozone Solar.R  Wind  Temp Month   Day Wind_d     </span></span>
<span id="cb583-4"><a href="chapter-ggplot2.html#cb583-4" tabindex="-1"></a><span class="do">##    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;fct&gt;      </span></span>
<span id="cb583-5"><a href="chapter-ggplot2.html#cb583-5" tabindex="-1"></a><span class="do">##  1    41     190   7.4    67     5     1 [1.7,7.4]  </span></span>
<span id="cb583-6"><a href="chapter-ggplot2.html#cb583-6" tabindex="-1"></a><span class="do">##  2    36     118   8      72     5     2 (7.4,9.7]  </span></span>
<span id="cb583-7"><a href="chapter-ggplot2.html#cb583-7" tabindex="-1"></a><span class="do">##  3    12     149  12.6    74     5     3 (11.5,20.7]</span></span>
<span id="cb583-8"><a href="chapter-ggplot2.html#cb583-8" tabindex="-1"></a><span class="do">##  4    18     313  11.5    62     5     4 (9.7,11.5] </span></span>
<span id="cb583-9"><a href="chapter-ggplot2.html#cb583-9" tabindex="-1"></a><span class="do">##  5    NA      NA  14.3    56     5     5 (11.5,20.7]</span></span>
<span id="cb583-10"><a href="chapter-ggplot2.html#cb583-10" tabindex="-1"></a><span class="do">##  6    28      NA  14.9    66     5     6 (11.5,20.7]</span></span>
<span id="cb583-11"><a href="chapter-ggplot2.html#cb583-11" tabindex="-1"></a><span class="do">##  7    23     299   8.6    65     5     7 (7.4,9.7]  </span></span>
<span id="cb583-12"><a href="chapter-ggplot2.html#cb583-12" tabindex="-1"></a><span class="do">##  8    19      99  13.8    59     5     8 (11.5,20.7]</span></span>
<span id="cb583-13"><a href="chapter-ggplot2.html#cb583-13" tabindex="-1"></a><span class="do">##  9     8      19  20.1    61     5     9 (11.5,20.7]</span></span>
<span id="cb583-14"><a href="chapter-ggplot2.html#cb583-14" tabindex="-1"></a><span class="do">## 10    NA     194   8.6    69     5    10 (7.4,9.7]  </span></span>
<span id="cb583-15"><a href="chapter-ggplot2.html#cb583-15" tabindex="-1"></a><span class="do">## # ℹ 143 more rows</span></span></code></pre></div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-16">5.24</a>에서 변수 <code>Wind</code>가 큰 값을 가질수록 두 변수의 관계가 점점 미약해지고 있음을 알 수 있다.
세 연속형 변수의 관계를 탐색하는 방법 중 하나가 된다.</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="chapter-ggplot2.html#cb584-1" tabindex="-1"></a>air_1 <span class="sc">|&gt;</span> </span>
<span id="cb584-2"><a href="chapter-ggplot2.html#cb584-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb584-3"><a href="chapter-ggplot2.html#cb584-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb584-4"><a href="chapter-ggplot2.html#cb584-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(Wind_d))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-16"></span>
<img src="_main_files/figure-html/5-16-1.png" alt="연속형 변수의 faceting" width="576" />
<p class="caption">
그림 5.24: 연속형 변수의 faceting
</p>
</div>
<p>Faceting은 기존의 그래프에 다른 변수의 정보를 추가하고자 할 때 매우 유용하게 사용되는 기법인데,
이러한 기능은 색깔 또는 점의 크기 등을 변수와 연결하는 매핑도 갖고 있는 기능이다.
두 기법은 서로 약간 다른 장단점이 있는데, faceting은 점들이 많이 겹쳐지는 경우에 더 명확하게 다른 변수의 정보를 확인할 수 있지만, 각 패널마다 작성된 그래프에 미세한 차이가 있는 경우에는 확인이 어려울 수 있다는 문제가 있다.</p>
<p>그림 <a href="chapter-ggplot2.html#fig:5-16">5.24</a>을 작성한 상황에서 변수 <code>Wind_d</code>를 색깔과 점의 크기와 연결시켜 나머지 두 변수의 산점도를 작성해 보자.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="chapter-ggplot2.html#cb585-1" tabindex="-1"></a>air_1 <span class="sc">|&gt;</span> </span>
<span id="cb585-2"><a href="chapter-ggplot2.html#cb585-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb585-3"><a href="chapter-ggplot2.html#cb585-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Solar.R, <span class="at">y =</span> Ozone, </span>
<span id="cb585-4"><a href="chapter-ggplot2.html#cb585-4" tabindex="-1"></a>                 <span class="at">color =</span> Wind_d,</span>
<span id="cb585-5"><a href="chapter-ggplot2.html#cb585-5" tabindex="-1"></a>                 <span class="at">size =</span> Wind_d))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-17"></span>
<img src="_main_files/figure-html/5-17-1.png" alt="매핑과 faceting의 비교" width="480" />
<p class="caption">
그림 5.25: 매핑과 faceting의 비교
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-17">5.25</a>은 너무 많은 점들이 서로 겹쳐 있어서 관계를 확인하는 데 약간의 어려움이 있으며, 따라서 좋지 않은 그래프라고 하겠다.</p>
</div>
<div id="section-geom" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> 기하 객체: Geometric object<a href="chapter-ggplot2.html#section-geom" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>우리가 작성하고자 하는 그래프는 일반적으로 점이나 선 또는 문자와 같은 몇 가지 유형의 ’기하 객체’로 이루어져 있다.
함수 <code>plot()</code> 등이 속한 <code>base graphics</code> 시스템에서는 높은-수준의 그래프 함수로 좌표축을 포함한 주된 유형의 그래프를 먼저 작성하고,
이어서 낮은-수준의 그래프 함수를 연속 사용하여 다른 유형의 ’기하 객체’를 추가하는 방식으로 그래프를 작성한다.</p>
<p>패키지 <code>ggplot2</code>에서는 각 유형 별 그래프를 따로 작성하고, 그것을 겹쳐 놓는 방식으로 그래프를 작성한다.
각 유형의 ’기하 객체’를 사용한 그래프를 작성하기 위해서는 해당되는 <code>geom</code> 함수를 실행하면 된다.
각 <code>geom</code> 함수가 실행되면 해당 유형의 그래프가 작성된 레이어(layer)가 생성되는데,
첫 번째 <code>geom</code> 함수로 생성된 레이어가 가장 밑에 놓이고,
다음 <code>geom</code> 함수의 레이어가 그 위에 차례로 겹쳐짐으로써 최종적으로 원하는 그래프를 얻게 된다.</p>
<p>그림 <a href="chapter-ggplot2.html#fig:5-18-1">5.26</a>과 그림 <a href="chapter-ggplot2.html#fig:5-18-2">5.27</a>는 데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>를 대상으로 <code>geom_point()</code>와 <code>geom_smooth()</code>를 각각 적용한 결과를 보여주고 있다.
동일한 자료를 사용하더라도 다른 <code>geom</code> 함수를 사용하면 다른 그래프가 작성되는 것을 알 수 있다.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="chapter-ggplot2.html#cb586-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb586-2"><a href="chapter-ggplot2.html#cb586-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-18-1"></span>
<img src="_main_files/figure-html/5-18-1-1.png" alt="함수 `geom_point()`에 의한 그래프" width="576" />
<p class="caption">
그림 5.26: 함수 <code>geom_point()</code>에 의한 그래프
</p>
</div>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="chapter-ggplot2.html#cb587-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb587-2"><a href="chapter-ggplot2.html#cb587-2" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-18-2"></span>
<img src="_main_files/figure-html/5-18-2-1.png" alt="함수 `geom_smooth()`에 의한 그래프" width="576" />
<p class="caption">
그림 5.27: 함수 <code>geom_smooth()</code>에 의한 그래프
</p>
</div>
<p>현재 <code>ggplot2</code>에는 대략 30개 이상의 <code>geom</code> 함수가 있다.
예를 들어 한 변수를 대상으로 하는 <code>geom</code> 함수로는 <code>geom_bar()</code>, <code>geom_histogram()</code>, <code>geom_density()</code>,
<code>geom_dotplot()</code> 등이 있고, 두 변수를 대상으로 하는 함수로는 <code>geom_point()</code>, <code>geom_smooth()</code>,
<code>geom_text()</code>, <code>geom_line()</code>, <code>geom_boxplot()</code> 등이 있으며, 세 변수에 대한 함수로는 <code>geom_contour()</code>,
<code>geom_tile()</code> 등이 있다. 사용할 수 있는 <code>geom</code> 함수들의 리스트는 RStudio의 메뉴에서
<code>Help &gt; Cheatsheets &gt; Data Visualization with ggplot2</code>를 선택하면 볼 수 있다.</p>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 글로벌 매핑과 로컬 매핑</p>
<p>데이터 프레임 <code>mpg</code>에서 변수 <code>displ</code>과 <code>hwy</code>의 산점도에 두 변수의 비모수 회귀곡선을 겹쳐서 나타내 보자.
비모수 회귀곡선이란 일반적으로 두 변수의 관계를 가장 잘 설명해주는
매끄러운(smooth) 곡선(line)을 의미하는 것이며, 함수 <code>geom_smooth()</code>가 그래프로 표현하는 기능을 갖고 있다.
따라서 원하는 작업을 수행하기 위해서는 함수 <code>geom_point()</code>와 함수 <code>geom_smooth()</code>를 함께 사용해야 하는데,
이 경우에 두 <code>geom</code> 함수에 적용되는 매핑이 동일하기 때문에 같은 내용을 다음과 같이 중복해서 입력하게 된다.</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="chapter-ggplot2.html#cb588-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb588-2"><a href="chapter-ggplot2.html#cb588-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb588-3"><a href="chapter-ggplot2.html#cb588-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy))   <span class="co"># 중복된 입력</span></span></code></pre></div>
<p>이러한 중복 입력의 문제는 함수 <code>ggplot()</code>에 있는 매핑 기능을 다음과 같이 사용하면 해결된다.</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="chapter-ggplot2.html#cb589-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span>  <span class="co"># 글로벌 매핑</span></span>
<span id="cb589-2"><a href="chapter-ggplot2.html#cb589-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb589-3"><a href="chapter-ggplot2.html#cb589-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-19"></span>
<img src="_main_files/figure-html/5-19-1.png" alt="글로벌 매핑을 적용해서 작성한 그래프" width="576" />
<p class="caption">
그림 5.28: 글로벌 매핑을 적용해서 작성한 그래프
</p>
</div>
<p>함수 <code>ggplot()</code>에 있는 매핑 기능은 해당 그래프 작성에 참여한 모든 <code>geom</code> 함수에 공통적으로 적용되는 일종의 글로벌 매핑이다.
반면에 함수 <code>geom</code>에 있는 매핑은 해당 <code>geom</code>으로 작성되는 레이어에만 적용되는 일종의 로컬 매핑이다.
따라서 여러 <code>geom</code> 함수에서 동일한 매핑을 사용한다면 한 번의 글로벌 매핑을 사용하는 것이 중복을 피하는 방법이 된다.</p>
<p>글로벌 매핑이 모든 <code>geom</code> 함수에 공통적으로 적용되기는 하지만, 실질적으로 레이어를
작성하는 <code>geom</code> 함수에서 이루어지는 로컬 매핑이 글로벌 매핑보다 우선해서 적용된다.
따라서 각 레이어에서 글로벌 매핑과 다른 내용으로 매핑을 할 수 있는데, 이러한 특성으로 인하여 훨씬 다양한 형태의 그래프를 작성할 수 있다.</p>
<p>데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 비모수 회귀곡선을 작성하고, 그 위에
산점도를 추가하되 변수 <code>drv</code>의 값에 따라 점의 색을 다르게 표시해 보자.
이와 같이 두 개 이상의 <code>geom</code> 함수를 사용해야 하는 경우, 글로벌 매핑과 로컬 매핑을 명확하게 구분해서
지정해야 한다. 여기에서 사용되는 매핑은 변수 <code>displ</code>과 <code>hwy</code>를 <code>x</code>와 <code>y</code>에 연결하는 것과 변수 <code>drv</code>에 <code>color</code>를 연결하는 세 가지가 있다.
세 가지를 모두 글로벌 매핑으로 지정한 그래프가 그림 <a href="chapter-ggplot2.html#fig:5-20-1">5.29</a>에 있고, <code>color</code>를 함수 <code>geom_point()</code>에서 로컬 매핑으로 지정한 그래프가 그림 <a href="chapter-ggplot2.html#fig:5-20-2">5.30</a>에 있다.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="chapter-ggplot2.html#cb590-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy, <span class="at">color =</span> drv)) <span class="sc">+</span></span>
<span id="cb590-2"><a href="chapter-ggplot2.html#cb590-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb590-3"><a href="chapter-ggplot2.html#cb590-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-20-1"></span>
<img src="_main_files/figure-html/5-20-1-1.png" alt="글로벌 매핑만 작용한 그래프" width="576" />
<p class="caption">
그림 5.29: 글로벌 매핑만 작용한 그래프
</p>
</div>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="chapter-ggplot2.html#cb591-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb591-2"><a href="chapter-ggplot2.html#cb591-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> drv)) <span class="sc">+</span></span>
<span id="cb591-3"><a href="chapter-ggplot2.html#cb591-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-20-2"></span>
<img src="_main_files/figure-html/5-20-2-1.png" alt="color는 로컬 매핑을 적용한 그래프" width="576" />
<p class="caption">
그림 5.30: color는 로컬 매핑을 적용한 그래프
</p>
</div>
<p>세 가지 매핑이 모두 글로벌로 지정된 경우에는 비모수 회귀곡선의 추정도 변수 <code>drv</code>로
구분되는 그룹별로 각각 이루어졌다는 것을 알 수 있다. 함수 <code>geom_smooth()</code>에서 옵션
<code>se=FALSE</code>를 사용하면 그래프에 비모수 회귀곡선의 신뢰구간이 표시되지 않는다.</p>
<p>이번에는 데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 비모수 회귀곡선을 변수 <code>drv</code>에
의해 구분되는 그룹별로 각각 추정하여 선의 종류를 다르게 표시하고, 그 위에 변수 <code>drv</code>의
값에 따라 점의 색을 다르게 하여 산점도를 추가해 보자. 또한 산점도의 점 크기도 조금
크게 하자. 여기에서 사용될 선의 종류도 시각적 요소로써 변수와의 연결은 입력 요소
<code>linetype</code>으로 지정한다.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="chapter-ggplot2.html#cb592-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb592-2"><a href="chapter-ggplot2.html#cb592-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> drv), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb592-3"><a href="chapter-ggplot2.html#cb592-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> drv), <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-21"></span>
<img src="_main_files/figure-html/5-21-1.png" alt="두 `geom` 함수에서 `color`와 `linetype`을 각각 로컬 매핑한 그래프" width="576" />
<p class="caption">
그림 5.31: 두 <code>geom</code> 함수에서 <code>color</code>와 <code>linetype</code>을 각각 로컬 매핑한 그래프
</p>
</div>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 글로벌 데이터와 로컬 데이터</p>
<p>매핑에서와 같이 데이터도 함수 <code>ggplot()</code>에서 지정하는 글로벌 데이터와 개별 <code>geom</code> 함수에서 지정하는 로컬 데이터로 구분된다.
즉, 함수 <code>ggplot()</code>에 지정되는 <code>data</code>는 모든 <code>geom</code> 함수에 기본적으로 적용되고, 각 <code>geom</code> 함수에서 지정되는 <code>data</code>는 해당 레이어 작성에만 적용된다.</p>
<p>예를 들어 데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 산점도를 작성하되,
변수 <code>drv</code>의 값에 따라 점의 색을 다르게 하고, 그 위에 두 변수의 비모수 회귀곡선을 추가하되 변수 <code>drv</code>의 값이 4인 데이터만을 대상으로 추정해 보자.
이 경우에는 함수 <code>geom_smooth()</code>에 데이터 프레임 <code>mpg</code> 중 변수 <code>drv</code>의 값이 4인 케이스만 선택한 로컬 데이터를 지정해야 한다.</p>
<p>각 <code>geom</code> 함수에서 로컬 데이터를 지정할 때 주의할 점이 하나 있는데,
그것은 로컬 데이터를 지정하는 요소 <code>data =</code>가 모든 <code>geom</code>함수에서는 두 번째 요소라는 것이다.
따라서 다음과 같이 <code>geom</code> 함수 내에서 첫 번째에 위치하게 된다면 반드시 <code>data =</code>이라는 이름과 함께 로컬 데이터를 지정해야 한다.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="chapter-ggplot2.html#cb593-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb593-2"><a href="chapter-ggplot2.html#cb593-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> drv), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb593-3"><a href="chapter-ggplot2.html#cb593-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="fu">filter</span>(mpg, drv <span class="sc">==</span> <span class="st">&quot;4&quot;</span>),</span>
<span id="cb593-4"><a href="chapter-ggplot2.html#cb593-4" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-22"></span>
<img src="_main_files/figure-html/5-22-1.png" alt="로컬 데이터를 사용하여 작성한 레이어" width="576" />
<p class="caption">
그림 5.32: 로컬 데이터를 사용하여 작성한 레이어
</p>
</div>
<p>함수 <code>geom_text()</code>는 그래프에 문자 라벨을 추가할 때 사용되는 <code>geom</code> 함수인데, 로컬 데이터를 사용해야 하는 중요한 경우가 된다.
예를 들어, 두 연속형 변수의 산점도에 다른 점들과 조금 다른 특성을 보이는 점이 있다면, 해당 자료의 부가 정보를 표시할 수 있는 라벨을 점 주변에 추가하는 것이 좋을 것이다.</p>
<p>데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>cty</code>의 산점도를 작성해 보자.</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="chapter-ggplot2.html#cb594-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> cty)) <span class="sc">+</span></span>
<span id="cb594-2"><a href="chapter-ggplot2.html#cb594-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb594-3"><a href="chapter-ggplot2.html#cb594-3" tabindex="-1"></a>p1</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-1"></span>
<img src="_main_files/figure-html/5-geom-text-1-1.png" alt="변수 `displ`과 `cty`의 산점도" width="576" />
<p class="caption">
그림 5.33: 변수 <code>displ</code>과 <code>cty</code>의 산점도
</p>
</div>
<p>변수 <code>displ</code>이 증가하면 <code>cty</code>가 감소하는 관계를 보여주는 산점도가 작성되었는데, 변수 <code>cty</code>의 값이 유독 큰 두 점을 볼 수 있다. 두 점이 어떤 자동차에 해당되는 자료인지 확인해 보자.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="chapter-ggplot2.html#cb595-1" tabindex="-1"></a>mpg <span class="sc">|&gt;</span>  </span>
<span id="cb595-2"><a href="chapter-ggplot2.html#cb595-2" tabindex="-1"></a>  <span class="fu">slice_max</span>(cty, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb595-3"><a href="chapter-ggplot2.html#cb595-3" tabindex="-1"></a>  <span class="fu">select</span>(manufacturer, model, cty)</span>
<span id="cb595-4"><a href="chapter-ggplot2.html#cb595-4" tabindex="-1"></a><span class="do">## # A tibble: 2 × 3</span></span>
<span id="cb595-5"><a href="chapter-ggplot2.html#cb595-5" tabindex="-1"></a><span class="do">##   manufacturer model        cty</span></span>
<span id="cb595-6"><a href="chapter-ggplot2.html#cb595-6" tabindex="-1"></a><span class="do">##   &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt;</span></span>
<span id="cb595-7"><a href="chapter-ggplot2.html#cb595-7" tabindex="-1"></a><span class="do">## 1 volkswagen   new beetle    35</span></span>
<span id="cb595-8"><a href="chapter-ggplot2.html#cb595-8" tabindex="-1"></a><span class="do">## 2 volkswagen   jetta         33</span></span></code></pre></div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-geom-text-1">5.33</a>의 산점도에 변수 <code>cty</code>의 값이 큰 두 점 주변에 라벨을 추가해 보자.
함수 <code>geom_text()</code>에서 라벨의 위치는 시각적 요소 <code>x</code>와 <code>y</code>에, 라벨 내용은 <code>label</code>에 매핑을 한다.
변수 <code>manufacturer</code>와 <code>model</code>의 값을 서로 붙여 라벨로 표시해 보자.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="chapter-ggplot2.html#cb596-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">slice_max</span>(mpg, cty, <span class="at">n =</span> <span class="dv">2</span>), </span>
<span id="cb596-2"><a href="chapter-ggplot2.html#cb596-2" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(manufacturer, model)))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-2"></span>
<img src="_main_files/figure-html/5-geom-text-2-1.png" alt="변수 `displ`과 `cty`의 산점도에 라벨 추가" width="576" />
<p class="caption">
그림 5.34: 변수 <code>displ</code>과 <code>cty</code>의 산점도에 라벨 추가
</p>
</div>
<p>라벨 내용이 점과 겹쳐졌고, 왼쪽 부분이 잘려서 보이지 않게 되었다.
이런 경우에는 라벨의 위치를 조정할 필요가 있는데, 라벨의 위치 조정은 <code>vjust</code>, <code>hjust</code>와 <code>nudge_x</code>, <code>nudge_y</code>로 할 수 있다.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="chapter-ggplot2.html#cb597-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">slice_max</span>(mpg, cty, <span class="at">n =</span> <span class="dv">2</span>), </span>
<span id="cb597-2"><a href="chapter-ggplot2.html#cb597-2" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(manufacturer, model)),</span>
<span id="cb597-3"><a href="chapter-ggplot2.html#cb597-3" tabindex="-1"></a>               <span class="at">nudge_x =</span> <span class="fl">0.3</span>, <span class="at">nudge_y =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-3"></span>
<img src="_main_files/figure-html/5-geom-text-3-1.png" alt="변수 `displ`과 `cty`의 산점도에 추가된 라벨의 위치 조정" width="576" />
<p class="caption">
그림 5.35: 변수 <code>displ</code>과 <code>cty</code>의 산점도에 추가된 라벨의 위치 조정
</p>
</div>
<p><code>nudge_x</code>에 양의 값을 지정하면 우측으로 이동하고, 음의 값을 지정하면 죄측으로 이동한다.
또한 <code>nudge_y</code>에는 양의 값을 지정하면 위로 이동하고, 음의 값을 지정하면 아래로 이동한다.
지정하는 값은 XY축의 scale에 맞추어 사용자가 결정해야 한다.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="chapter-ggplot2.html#cb598-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">slice_max</span>(mpg, cty, <span class="at">n =</span> <span class="dv">2</span>), </span>
<span id="cb598-2"><a href="chapter-ggplot2.html#cb598-2" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(manufacturer, model)),</span>
<span id="cb598-3"><a href="chapter-ggplot2.html#cb598-3" tabindex="-1"></a>               <span class="at">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="at">vjust =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-4"></span>
<img src="_main_files/figure-html/5-geom-text-4-1.png" alt="변수 `displ`과 `cty`의 산점도에 추가된 라벨의 위치 조정" width="576" />
<p class="caption">
그림 5.36: 변수 <code>displ</code>과 <code>cty</code>의 산점도에 추가된 라벨의 위치 조정
</p>
</div>
<p><code>hjust</code>에는 <code>"left"</code>, <code>"middle"</code>, <code>"right"</code> 중 하나를 지정하고, <code>vjust</code>에는 <code>"bottom"</code>, <code>"center"</code>, <code>"top"</code> 중 하나를 지정하면 된다.
그림 <a href="chapter-ggplot2.html#fig:5-geom-text-4">5.36</a>의 경우에는 <code>hjust = "left"</code>와 <code>vjust = "top"</code>을 지정한 것인데,
<code>hjust = "left"</code>로써 점이 라벨의 왼쪽에, <code>vjust = "top"</code>로써 점이 라벨의 위쪽에 있도록 조정한 것이다.</p>
<p>라벨을 추가하려는 점의 위치가 너무 가까우면 라벨이 서로 겹쳐져서 내용을 알 수 없게 될 수 있다.
이런 경우에는 서로 겹치는 라벨 중 자료의 순서에 따라 먼저 작성되는 것만 표시하는 것이 좋은 방법이 될 수 있다.</p>
<p>데이터 프레임 <code>mpg</code>에서 변수 <code>displ</code>과 <code>hwy</code>의 산점도를 작성해 보자.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="chapter-ggplot2.html#cb599-1" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb599-2"><a href="chapter-ggplot2.html#cb599-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb599-3"><a href="chapter-ggplot2.html#cb599-3" tabindex="-1"></a>p2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-5"></span>
<img src="_main_files/figure-html/5-geom-text-5-1.png" alt="변수 `displ`과 `hwy`의 산점도" width="576" />
<p class="caption">
그림 5.37: 변수 <code>displ</code>과 <code>hwy</code>의 산점도
</p>
</div>
<p>변수 <code>hwy</code>의 값이 40이 넘는 자동차의 <code>manufacturer</code>와 <code>model</code>의 값을 출력해 보자.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="chapter-ggplot2.html#cb600-1" tabindex="-1"></a>mpg <span class="sc">|&gt;</span>  </span>
<span id="cb600-2"><a href="chapter-ggplot2.html#cb600-2" tabindex="-1"></a>  <span class="fu">filter</span>(hwy <span class="sc">&gt;</span> <span class="dv">40</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb600-3"><a href="chapter-ggplot2.html#cb600-3" tabindex="-1"></a>  <span class="fu">select</span>(manufacturer, model, hwy)</span>
<span id="cb600-4"><a href="chapter-ggplot2.html#cb600-4" tabindex="-1"></a><span class="do">## # A tibble: 3 × 3</span></span>
<span id="cb600-5"><a href="chapter-ggplot2.html#cb600-5" tabindex="-1"></a><span class="do">##   manufacturer model        hwy</span></span>
<span id="cb600-6"><a href="chapter-ggplot2.html#cb600-6" tabindex="-1"></a><span class="do">##   &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt;</span></span>
<span id="cb600-7"><a href="chapter-ggplot2.html#cb600-7" tabindex="-1"></a><span class="do">## 1 volkswagen   jetta         44</span></span>
<span id="cb600-8"><a href="chapter-ggplot2.html#cb600-8" tabindex="-1"></a><span class="do">## 2 volkswagen   new beetle    44</span></span>
<span id="cb600-9"><a href="chapter-ggplot2.html#cb600-9" tabindex="-1"></a><span class="do">## 3 volkswagen   new beetle    41</span></span></code></pre></div>
<p>변수 <code>hwy</code>의 값이 40이 넘는 자료가 그림 <a href="chapter-ggplot2.html#fig:5-geom-text-5">5.37</a>에는 2개로 표시되었지만, 사실은 3개의 자료가 있는 것을 알 수 있다.
이제 이 자료에 라벨을 추가하면, 당연히 두 개의 라벨이 겹쳐서 나타나게 된다.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="chapter-ggplot2.html#cb601-1" tabindex="-1"></a>p2 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">slice_max</span>(mpg, hwy, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb601-2"><a href="chapter-ggplot2.html#cb601-2" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(manufacturer, model)),</span>
<span id="cb601-3"><a href="chapter-ggplot2.html#cb601-3" tabindex="-1"></a>               <span class="at">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="at">vjust =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-6"></span>
<img src="_main_files/figure-html/5-geom-text-6-1.png" alt="변수 `displ`과 `hwy`의 산점도에 라벨 추가" width="576" />
<p class="caption">
그림 5.38: 변수 <code>displ</code>과 <code>hwy</code>의 산점도에 라벨 추가
</p>
</div>
<p>이런 경우에는 함수 <code>geom_text()</code>에 옵션 <code>check_overlap</code>에 <code>TRUE</code>를 지정하면, 겹치는 라벨 중 자료의 순서에 따라 먼저 작성되는 것만 표시하게 된다.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="chapter-ggplot2.html#cb602-1" tabindex="-1"></a>p2 <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">slice_max</span>(mpg, hwy, <span class="at">n =</span> <span class="dv">3</span>),</span>
<span id="cb602-2"><a href="chapter-ggplot2.html#cb602-2" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(manufacturer, model)),</span>
<span id="cb602-3"><a href="chapter-ggplot2.html#cb602-3" tabindex="-1"></a>               <span class="at">hjust =</span> <span class="st">&quot;left&quot;</span>, <span class="at">vjust =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb602-4"><a href="chapter-ggplot2.html#cb602-4" tabindex="-1"></a>               <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-text-7"></span>
<img src="_main_files/figure-html/5-geom-text-7-1.png" alt="변수 `displ`과 `hwy`의 산점도에 겹치지 않는 라벨만 추가" width="576" />
<p class="caption">
그림 5.39: 변수 <code>displ</code>과 <code>hwy</code>의 산점도에 겹치지 않는 라벨만 추가
</p>
</div>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 그래프 범례(legend) 추가</p>
<p>여러 개의 <code>geom</code> 함수를 사용해서 그래프를 작성하다 보면, 다른 종류의 선이나 점들이 나타나게 된다.
이런 경우에 각각의 선이나 점들에 대한 범례를 추가하지 않으면 그래프의 정보를 정확하게 전달할 수 없게 된다.
<code>base graphics</code>에서는 함수 <code>legend()</code>를 사용해서 그래프에 범례를 직접 추가할 수 있다.
<code>ggplot2</code>에는 이런 기능을 갖고 있는 함수는 없지만, <code>geom</code> 함수에서 문자열을 매핑하면 자동적으로 범례가 생성되는 기능을 이용하면 필요한 범례를 적절하게 추가할 수 있다.</p>
<p>데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 산점도에 두 변수의 비모수 회귀곡선과 선형회귀직선을 함께 표시해 보자.
비모수 회귀곡선과 선형회귀직선은 모두 함수 <code>geom_smooth()</code>로 작성할 수 있는데, <code>method</code>에 <code>"lm"</code>을 지정하면 선형회귀직선이 작성된다.
디폴트는 <code>"loess"</code>로써 비모수 회귀곡선이 작성된다.</p>
<p>두 가지 선을 색으로 구분하고 범례를 추가하려면, 함수 <code>aes()</code>에서 <code>color</code>에 범례에 표시하고자 하는 문자열을 매핑하면 된다.
<code>labs()</code>에서 <code>color = NULL</code>을 지정해서 범례의 제목을 제거했고, 함수 <code>theme()</code>에 <code>legend.position = "bottom"</code>을 입력해서 범례의 위치를 이동시켰다.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="chapter-ggplot2.html#cb603-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb603-2"><a href="chapter-ggplot2.html#cb603-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb603-3"><a href="chapter-ggplot2.html#cb603-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;lm&quot;</span>), </span>
<span id="cb603-4"><a href="chapter-ggplot2.html#cb603-4" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb603-5"><a href="chapter-ggplot2.html#cb603-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;loess&quot;</span>), </span>
<span id="cb603-6"><a href="chapter-ggplot2.html#cb603-6" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb603-7"><a href="chapter-ggplot2.html#cb603-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Engine displacement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Highway MPG&quot;</span>, <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb603-8"><a href="chapter-ggplot2.html#cb603-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Scatter plot with regression lines&quot;</span>) <span class="sc">+</span></span>
<span id="cb603-9"><a href="chapter-ggplot2.html#cb603-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-geom-legend"></span>
<img src="_main_files/figure-html/5-geom-legend-1.png" alt="그래프에 범례 추가" width="576" />
<p class="caption">
그림 5.40: 그래프에 범례 추가
</p>
</div>
</div>
<div id="통계적-변환-statistical-transformation" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> 통계적 변환: Statistical transformation<a href="chapter-ggplot2.html#통계적-변환-statistical-transformation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>그래프 작성 과정에서 함수 <code>ggplot()</code>에 입력된 데이터 프레임의 자료가 그대로 사용되는
경우도 있지만, 통계적 변환 과정을 거쳐 생성된 자료가 사용되는 경우도 많이 있다.
예를 들어 산점도는 입력된 자료를 그대로 사용해서 작성할 수 있는 그래프이지만, 비모수 회귀
곡선의 경우에는 적절한 추정 과정을 통해 새롭게 생성된 자료를 사용해야 작성할 수 있는 그래프이다.</p>
<p>통계적 변환(혹은 <code>stat</code>)이란 함수 <code>ggplot()</code>에 입력된 데이터 프레임 자료의 변환을 의미하는 것으로써
각 그래프 유형별로 대응되는 <code>stat</code>이 존재한다.
예를 들어 산점도와 같이 입력된 자료 그대로가 사용되는 경우에 대한 <code>stat</code>은 <code>"identity"</code>이며,
비모수 회귀곡선의 작성에 필요한 <code>stat</code>은 <code>"smooth"</code>가 된다.</p>
<p>그런데 우리는 지금까지 두 종류의 그래프를 작성할 때 <code>geom</code> 함수에 별도로 <code>stat</code>을 지정하지 않았다.
이것은 모든 <code>geom</code> 함수에는 미리 설정된 디폴트 <code>stat</code>이 존재하는 것을 의미한다.
예를 들어 <code>geom_point()</code>는 <code>geom_point(stat = "identity")</code>와 동일한 것이고,
<code>geom_smooth()</code>는 <code>geom_smooth(stat = "smooth")</code>와 동일한 것이다.</p>
<p>그래프는 <code>geom</code> 함수를 사용하지 않고 <code>stat</code> 함수를 대신 사용해도 작성할 수 있다.
예를 들어 함수 <code>stat_smooth()</code>는 함수 <code>geom_smooth()</code>의 디폴트 <code>stat</code>인 <code>"smooth"</code>에 대응되는 함수인데,
<code>geom_smooth()</code> 대신 사용해도 동일한 그래프를 작성할 수 있다.</p>
<p>이와 같이 모든 <code>geom</code> 함수는 그것을 대체할 수 있는 <code>stat</code> 함수가 존재한다.
또한 <code>geom</code> 함수의 경우처럼 모든 <code>stat</code> 함수에는 디폴트 <code>geom</code>이 설정되어 있다.
예를 들어 함수 <code>stat_identity()</code>는 <code>stat_identity(geom = "point")</code>를 의미한다.</p>
<p><code>stat</code> 함수를 활용해서 막대 그래프를 작성해 보자.
막대 그래프는 범주형 변수의 분포를 나타내는 데 적합한 그래프로써, 함수 <code>geom_bar()</code>로 작성한다.
이때 사용되는 디폴트 <code>stat</code>은 <code>"count"</code>이다. 따라서 <code>geom_bar()</code> 또는 <code>stat_count()</code>로 동일한
막대 그래프를 작성할 수 있다. 데이터 프레임 <code>mpg</code>의 변수 <code>trans</code>는 자동차의 변속기 종류를 나타내고 있다.
변수 <code>trans</code>의 막대 그래프를 <code>geom_bar()</code>와 <code>stat_count()</code>로 각각 작성해 보자.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="chapter-ggplot2.html#cb604-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> trans)) <span class="sc">+</span></span>
<span id="cb604-2"><a href="chapter-ggplot2.html#cb604-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="chapter-ggplot2.html#cb605-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> trans)) <span class="sc">+</span></span>
<span id="cb605-2"><a href="chapter-ggplot2.html#cb605-2" tabindex="-1"></a>  <span class="fu">stat_count</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-23"></span>
<img src="_main_files/figure-html/5-23-1.png" alt="변수 `trans`의 막대 그래프" width="576" />
<p class="caption">
그림 5.41: 변수 <code>trans</code>의 막대 그래프
</p>
</div>
<p>그래프를 <code>geom</code> 함수를 사용하여 작성할 것인지 혹은 <code>stat</code> 함수를 사용하여 작성할 것인지는 사용자가 더 편한 방법을 선택하면 된다고 본다.
그러나 일반적으로 그래프 유형을 쉽게 확인할 수 있는 <code>geom</code> 함수를 사용하는 것이 직관적으로 더 명확하다고 보여지기 때문에 특별한 상황이 아니라면 <code>geom</code> 함수를 사용하여 그래프를 작성하는 것이 더 좋을 듯하다.</p>
<p>함수 <code>ggplot()</code>으로 그래프를 작성하는 과정에서 <code>stat</code> 함수는 데이터 프레임을 입력 자료로 받고
변환과정을 거쳐 그래프 작성에 필요한 변수들로 이루어진 데이터 프레임을 내부적으로 생성한다.
이런 과정을 통해 <code>stat</code> 함수가 생성한 변수들은 사용자가 직접 지정하여 사용할 수 있다.
예를 들어 함수 <code>geom_bar()</code> 또는 <code>stat_count()</code>는 <code>count</code>와 <code>prop</code>라는 두 변수를 생성하는데,
변수 <code>count</code>는 각 범주의 도수로써 막대 그래프의 디폴트 막대 높이로 사용된다.
변수 <code>prop</code>는 그룹별 비율을 의미하는 것으로 막대 그래프의 막대 높이를 상대도수로 작성하고자 한다면 사용해야 할 변수가 된다.</p>
<p><code>stat</code> 함수에서 생성된 변수를 사용자가 직접 지정해서 사용할 때는 함수 <code>after_stat()</code>에 해당 변수를 입력하면 된다. 예를 들어 <code>stat_count()</code>에서 생성된 변수 <code>prop</code>를 사용자가 직접 사용하기 위해서는 <code>after_stat(prop)</code>라고 지정하면 된다.
이전에는 <code>..prop..</code>나 <code>stat(prop)</code>가 사용되었으나, 이제는 함수 <code>after_stat()</code>의 사용이 권장되고 있다.</p>
<p>데이터 프레임 <code>mpg</code>의 변수 <code>trans</code>에 대한 막대 그래프를 상대도수를 이용하여 작성해 보자.
이 경우 변수 <code>after_stat(prop)</code>를 시각적 요소 <code>y</code>로 매핑하는 것이 필요한데, 문제는 <code>y</code>에 대한 매핑만으로는
원하는 형태의 그래프를 얻을 수 없다는 것이다.</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="chapter-ggplot2.html#cb606-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb606-2"><a href="chapter-ggplot2.html#cb606-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> trans, <span class="at">y =</span> <span class="fu">after_stat</span>(prop)))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-24-1"></span>
<img src="_main_files/figure-html/5-24-1-1.png" alt="디폴트 `group`에 의해 잘못 작성된 막대 그래프" width="576" />
<p class="caption">
그림 5.42: 디폴트 <code>group</code>에 의해 잘못 작성된 막대 그래프
</p>
</div>
<p>그 이유는 변수 <code>after_stat(prop)</code>가 그룹별 비율을 나타내고 있는데, 변수 <code>trans</code>의 각 범주가 개별 그룹으로
설정되는 것이 디폴트이기 때문이다. 따라서 각 그룹에는 한 범주의 도수만이 존재하게 되어
변수 <code>after_stat(prop)</code>는 항상 1이 된다.
이 문제는 개별 그룹으로 나눠져 있던 각 범주들을 하나의 그룹으로 묶어주면 해결이 된다.
자료들을 그룹으로 묶어주는 기능은 시각적 요소 <code>group</code>에 있는데, 모든 범주를 같은 그룹으로 묶어주는 것이므로
<code>group</code>에 하나의 값을 함수 <code>aes()</code> 안에서 지정해주면 된다.
프로그램에서는 <code>group = 1</code>으로 지정했지만, 어떤 값을 지정해도 상관없다.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="chapter-ggplot2.html#cb607-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb607-2"><a href="chapter-ggplot2.html#cb607-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> trans, <span class="at">y =</span> <span class="fu">after_stat</span>(prop), <span class="at">group =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-24-2"></span>
<img src="_main_files/figure-html/5-24-2-1.png" alt="`group`에 하나의 값을 지정하여 제대로 작성된 막대 그래프" width="576" />
<p class="caption">
그림 5.43: <code>group</code>에 하나의 값을 지정하여 제대로 작성된 막대 그래프
</p>
</div>
<p>변수 <code>trans</code>와 같이 범주의 이름이 비교적 긴 경우에 막대그래프를 <a href="chapter-ggplot2.html#fig:5-24-2">5.43</a>와 같이 수직 방향으로 작성하면, 범주의 이름이 겹치는 현상이 발생하게 된다.
이런 경우에는 <a href="chapter-ggplot2.html#fig:5-24-3">5.44</a>과 같이 수평 방향으로 작성하는 것이 더 바람직하다고 하겠다.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="chapter-ggplot2.html#cb608-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg) <span class="sc">+</span></span>
<span id="cb608-2"><a href="chapter-ggplot2.html#cb608-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> trans, <span class="at">x =</span> <span class="fu">after_stat</span>(prop), <span class="at">group =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-24-3"></span>
<img src="_main_files/figure-html/5-24-3-1.png" alt="수평 방향으로 작성된 막대 그래프" width="576" />
<p class="caption">
그림 5.44: 수평 방향으로 작성된 막대 그래프
</p>
</div>
<p>대부분의 경우, <code>geom</code> 함수에 어떤 <code>stat</code>을 지정해야 하는지 걱정할 필요 없이 디폴트 값을 그대로 사용하면 원하는 그래프를 작성할 수 있다.
하지만 몇몇 상황에서는 <code>stat</code>을 따로 지정해야 하는데, 막대 그래프의 경우에는 도수분포표를 자료로 입력하는 경우가 여기에 해당된다.
예를 들어 데이터 프레임 <code>mpg</code>의 변수 <code>trans</code>의 범주에서 <code>auto(av)</code>에서 <code>auto(s6)</code>까지를 <code>auto</code>로 통합하고
<code>manual(m5)</code>와 <code>manual(m6)</code>를 <code>manual</code>로 통합한 후, 두 범주에 속한 자료의 개수를 확인해 보자.
각 범주에 속한 자료의 개수를 세는 작업은 함수 <code>count()</code>로 할 수 있다.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="chapter-ggplot2.html#cb609-1" tabindex="-1"></a>mpg_am <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span> </span>
<span id="cb609-2"><a href="chapter-ggplot2.html#cb609-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">am =</span> <span class="fu">substr</span>(trans, <span class="dv">1</span>, <span class="fu">nchar</span>(trans)<span class="sc">-</span><span class="dv">4</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb609-3"><a href="chapter-ggplot2.html#cb609-3" tabindex="-1"></a>  <span class="fu">count</span>(am)</span></code></pre></div>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="chapter-ggplot2.html#cb610-1" tabindex="-1"></a>mpg_am</span>
<span id="cb610-2"><a href="chapter-ggplot2.html#cb610-2" tabindex="-1"></a><span class="do">## # A tibble: 2 × 2</span></span>
<span id="cb610-3"><a href="chapter-ggplot2.html#cb610-3" tabindex="-1"></a><span class="do">##   am         n</span></span>
<span id="cb610-4"><a href="chapter-ggplot2.html#cb610-4" tabindex="-1"></a><span class="do">##   &lt;chr&gt;  &lt;int&gt;</span></span>
<span id="cb610-5"><a href="chapter-ggplot2.html#cb610-5" tabindex="-1"></a><span class="do">## 1 auto     157</span></span>
<span id="cb610-6"><a href="chapter-ggplot2.html#cb610-6" tabindex="-1"></a><span class="do">## 2 manual    77</span></span></code></pre></div>
<p>데이터 프레임 <code>mpg_am</code>은 변수 <code>trans</code>의 범주를 <code>auto</code>와 <code>manual</code>로 통합한 변수 <code>am</code>의 도수분포표가 입력되어 있다.
이러한 도수분포표가 함수 <code>geom_bar()</code>에 자료로 입력된 경우 입력된 자료 그대로를 막대 그래프의 높이로 사용해야 한다.
따라서 이 경우에는 <code>stat</code>이 <code>"count"</code>가 아닌 <code>"identity"</code>로 지정을 해야 한다.</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="chapter-ggplot2.html#cb611-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg_am) <span class="sc">+</span></span>
<span id="cb611-2"><a href="chapter-ggplot2.html#cb611-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> am, <span class="at">y =</span> n), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-25"></span>
<img src="_main_files/figure-html/5-25-1.png" alt="함수 `geom_bar()`에 `stat=&quot;identity&quot;`를 지정해야 하는 경우" width="576" />
<p class="caption">
그림 5.45: 함수 <code>geom_bar()</code>에 <code>stat="identity"</code>를 지정해야 하는 경우
</p>
</div>
</div>
<div id="위치-조정-position-adjustments" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> 위치 조정: Position adjustments<a href="chapter-ggplot2.html#위치-조정-position-adjustments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>그래프를 작성하다 보면 그래프의 요소들이 서로 겹치는 경우가 있다.
이런 경우에 그래프 요소들의 위치를 약간 조정하여 서로 겹치지 않게 할 수 있다면 그래프의 완성도를 더 높일 수 있을 것이다.
그래프 요소들의 위치 조정이 필요한 경우로 연속형 자료의 산점도와 범주형 자료의 이변량 막대그래프가 있다.</p>
<p>연속형 변수의 특성상 원래의 자료가 서로 겹치는 경우는 거의 없다고 할 수 있다.
그러나 반올림 처리 등으로 같은 값이 많은 자료가 있을 수 있는데, 이런 경우에는 점의 위치에 약간의 난수를 추가하는 jittering으로 어느 정도 문제를 해결할 수 있다.
하지만, 대규모 자료들이 좁은 구역에 몰려서 하나의 큰 무리를 형성하는 경우, 점의 위치에 약간의 난수를 추가하는
위치 조정만으로는 문제 해결이 불가능할 것이며, 다른 방법을 사용해야 한다.
<a href="chapter-EDA.html#chapter-EDA">9</a>장에서 이런 문제에 대한 대안을 살펴보겠다.</p>
<p>위치 조정은 연속형 자료를 위한 그래프보다는 이산형 자료를 위한 그래프, 특히 이변량 막대 그래프
작성에서 가장 유용하게 사용된다.
이변량 막대 그래프는 두 범주형 변수의 분포를 함께 나타내는 막대 그래프로서, 쌓아 올리는 형태 혹은 옆으로 붙여 놓은 형태를 취하게 된다.</p>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 산점도에서 점이 겹치는 문제</p>
<p>데이터 프레임 <code>mpg</code>의 변수 <code>cty</code>와 <code>hwy</code>의 산점도를 작성해 보자.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="chapter-ggplot2.html#cb612-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb612-2"><a href="chapter-ggplot2.html#cb612-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-26-1"></span>
<img src="_main_files/figure-html/5-26-1-1.png" alt="점들이 서로 겹쳐진 산점도" width="576" />
<p class="caption">
그림 5.46: 점들이 서로 겹쳐진 산점도
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-26-1">5.46</a>에 나타난 점의 개수는 데이터의 전체 개수인 234개에 훨씬 못 미쳐 보인다.
이것은 시내 연비와 고속도로 연비인 두 변수의 값이 모두 반올림 처리가 되어 자연수로 입력되었기
때문에 값이 같은 자료가 많아져서 발생한 현상이다.
이와 같이 산점도의 점들이 서로 겹치게 되면 자료가 갖고 있는 정보를 정확하게 파악하기 어렵게 되는데,
이것은 사실 산점도가 갖고 있는 가장 큰 문제이기도 하다.</p>
<p>산점도의 점이 겹치는 문제의 해결 방안은 경우에 따라 달라질 수밖에 없는데,
변수 <code>cty</code>와 <code>hwy</code>의 산점도 경우에는 각 자료에 약간의 난수(random noise)를 더해주어 점의 위치를 수정해 주는 방법을 사용하면 문제를 해결할 수 있다.
이와 같이 산점도의 점에 약간의 난수를 더해 점의 위치를 조정하기 위해서는 함수 <code>geom_point()</code>에
<code>position="jitter"</code>를 추가하면 되는데, 그 결과는 그림 <a href="chapter-ggplot2.html#fig:5-26-2">5.47</a>와 같다.</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="chapter-ggplot2.html#cb613-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb613-2"><a href="chapter-ggplot2.html#cb613-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-26-2"></span>
<img src="_main_files/figure-html/5-26-2-1.png" alt="옵션 `position='jitter'`의 효과" width="576" />
<p class="caption">
그림 5.47: 옵션 <code>position='jitter'</code>의 효과
</p>
</div>
<p>함수 <code>geom_jitter()</code>는 함수 <code>geom_point(position="jitter")</code>와 같은 기능을 갖고 있으며,
점의 위치를 조정하기 위해 사용되는 난수의 크기를 조절하는 옵션 <code>width</code>와 <code>height</code>를 간편하게 이용할 수 있다는 장점이 있다.</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="chapter-ggplot2.html#cb614-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,  <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb614-2"><a href="chapter-ggplot2.html#cb614-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">height =</span> <span class="fl">0.05</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-27-1"></span>
<img src="_main_files/figure-html/5-27-1-1.png" alt="함수 `geom_jitter()`에 옵션 `width`와 `height`를 사용한 그래프" width="576" />
<p class="caption">
그림 5.48: 함수 <code>geom_jitter()</code>에 옵션 <code>width</code>와 <code>height</code>를 사용한 그래프
</p>
</div>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="chapter-ggplot2.html#cb615-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,  <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb615-2"><a href="chapter-ggplot2.html#cb615-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">height =</span> <span class="fl">0.4</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-27-2"></span>
<img src="_main_files/figure-html/5-27-2-1.png" alt="함수 `geom_jitter()`에 옵션 `width`와 `height`를 사용한 그래프" width="576" />
<p class="caption">
그림 5.49: 함수 <code>geom_jitter()</code>에 옵션 <code>width</code>와 <code>height</code>를 사용한 그래프
</p>
</div>
<p><strong><span class="math inline">\(\bullet\)</span></strong> 이변량 막대그래프</p>
<p>이변량 막대그래프는 두 범주형 변수의 관계를 탐색할 때 많이 사용되는 그래프이다.
데이터 프레임 <code>mpg</code>에서 변수 <code>trans</code>의 범주를 <code>auto</code>와 <code>manual</code>로 통합한 변수 <code>am</code>과 <code>cyl</code>의 이변량 막대 그래프를 작성해 보자. 이 때 변수 <code>cyl</code>이 5인 케이스는 제거한다.</p>
<p>먼저 자료를 준비해 보자.</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="chapter-ggplot2.html#cb616-1" tabindex="-1"></a>mpg_1 <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span>  </span>
<span id="cb616-2"><a href="chapter-ggplot2.html#cb616-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">am =</span> <span class="fu">substr</span>(trans, <span class="dv">1</span>, <span class="fu">nchar</span>(trans) <span class="sc">-</span> <span class="dv">4</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb616-3"><a href="chapter-ggplot2.html#cb616-3" tabindex="-1"></a>  <span class="fu">filter</span>(cyl <span class="sc">!=</span> <span class="dv">5</span>)</span></code></pre></div>
<p>이변량 막대 그래프의 작성은 함수 <code>geom_bar()</code>로 할 수 있는데, 시각적 요소 <code>x</code>와 <code>fill</code>에 변수를 하나씩 대응시킨다.</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="chapter-ggplot2.html#cb617-1" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg_1, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cyl), <span class="at">fill =</span> am)) <span class="sc">+</span> </span>
<span id="cb617-2"><a href="chapter-ggplot2.html#cb617-2" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of Cylinders&quot;</span>) </span></code></pre></div>
<p>디폴트 형태는 시각적 요소 <code>fill</code>과 연결된 변수의 도수가 위로 쌓아 올려지는 <code>position = "stack"</code>이다.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="chapter-ggplot2.html#cb618-1" tabindex="-1"></a>p_1 <span class="sc">+</span> <span class="fu">geom_bar</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-28-1"></span>
<img src="_main_files/figure-html/5-28-1-1.png" alt="쌓아 올린 이변량 막대 그래프" width="576" />
<p class="caption">
그림 5.50: 쌓아 올린 이변량 막대 그래프
</p>
</div>
<p>옆으로 붙여 놓은 막대 그래프는 옵션 <code>position</code>에 <code>"dodge"</code> 또는 <code>"dodge2"</code>를 지정하면 작성된다.</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="chapter-ggplot2.html#cb619-1" tabindex="-1"></a>p_1 <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-28-2"></span>
<img src="_main_files/figure-html/5-28-2-1.png" alt="옆으로 붙여 놓은 이변량 막대 그래프" width="576" />
<p class="caption">
그림 5.51: 옆으로 붙여 놓은 이변량 막대 그래프
</p>
</div>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="chapter-ggplot2.html#cb620-1" tabindex="-1"></a>p_1 <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;dodge2&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-28-3"></span>
<img src="_main_files/figure-html/5-28-3-1.png" alt="옆으로 붙여 놓은 이변량 막대 그래프" width="576" />
<p class="caption">
그림 5.52: 옆으로 붙여 놓은 이변량 막대 그래프
</p>
</div>
<p>옵션 <code>position</code>에 <code>"fill"</code>을 지정하면, 시각적 요소 <code>x</code>에 매핑된 변수를 조건으로 하는 조건부 확률에 의한
쌓아 올린 막대 그래프가 작성된다. 따라서 모든 막대의 높이는 1이 된다.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="chapter-ggplot2.html#cb621-1" tabindex="-1"></a>p_1 <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">&quot;fill&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-28-4"></span>
<img src="_main_files/figure-html/5-28-4-1.png" alt="조건부 확률에 의한 쌓아 올린 이변량 막대 그래프" width="576" />
<p class="caption">
그림 5.53: 조건부 확률에 의한 쌓아 올린 이변량 막대 그래프
</p>
</div>
<p>연속형 변수의 분포를 그룹별로 비교하고자 하는 경우 유용하게 사용되는 그래프가 ‘나란히 서 있는’ 상자그림이다.
상자그림을 작성하는 <code>geom</code> 함수는 <code>geom_boxplot()</code>인데, 그룹을 구성하는 변수를 <code>x</code> 변수로 지정하고
연속형 변수를 <code>y</code> 변수로 지정하면 수직 방향으로 나란히 서 있는 상자그림을 작성할 수 있다.</p>
<p>예를 들어 데이터 프레임 <code>mpg</code>에서 변수 <code>trans</code>의 범주를 <code>auto</code>와 <code>manual</code>로 통합한 변수 <code>am</code>을 생성하고,
변수 <code>cyl</code>이 5인 케이스를 제거한 데이터 프레임 <code>mpg_1</code>을 대상으로, 변수 <code>cyl</code>에 따른 변수 <code>hwy</code>의 상자그림을 작성해 보자.
그룹을 구성하는 변수는 요인이거나 문자형 변수가 되어야 하는데, 변수 <code>cyl</code>은 정수형 변수이기 때문에 함수 <code>as.factor()</code>로 유형을 요인으로 변경하고 <code>x</code>에 매핑을 하였다.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="chapter-ggplot2.html#cb622-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg_1,  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cyl), <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb622-2"><a href="chapter-ggplot2.html#cb622-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb622-3"><a href="chapter-ggplot2.html#cb622-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of Cylinders&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-29-1"></span>
<img src="_main_files/figure-html/5-29-1-1.png" alt="그룹 변수가 하나인 나란히 서 있는 상자그림" width="576" />
<p class="caption">
그림 5.54: 그룹 변수가 하나인 나란히 서 있는 상자그림
</p>
</div>
<p>일반적으로 볼 수 있는 나란히 서 있는 상자그림은 하나의 그룹 변수를 대상으로 작성되는데,
만일 그룹을 구성하는 변수가 두 개라면 상자그림을 어떻게 배치하는 것이 최적이겠는가?
예를 들어 두 변수 <code>cyl</code>과 <code>am</code>을 그룹 변수로 지정하여 <code>hwy</code>의 상자그림을 작성해보자.
변수 <code>cyl</code>을 <code>x</code>에, 변수 <code>am</code>을 <code>fill</code>에 각각 매핑을 해서 작성하면, 변수 <code>cyl</code>에 따라 작성된 변수 <code>hwy</code>의 상자그림을 다시 변수 <code>am</code>에 따라 분할한 것처럼 보인다.
이러한 배치는 옵션 <code>position</code>에 <code>"dodge"</code>가 디폴트로 적용되어 작성된 결과이다.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="chapter-ggplot2.html#cb623-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg_1,  <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cyl), <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb623-2"><a href="chapter-ggplot2.html#cb623-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> am)) <span class="sc">+</span></span>
<span id="cb623-3"><a href="chapter-ggplot2.html#cb623-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of Cylinders&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-29-2"></span>
<img src="_main_files/figure-html/5-29-2-1.png" alt="그룹 변수가 두 개인 나란히 서 있는 상자그림" width="576" />
<p class="caption">
그림 5.55: 그룹 변수가 두 개인 나란히 서 있는 상자그림
</p>
</div>
<p>다른 방법으로 faceting을 사용한 그래프를 작성할 수 있다.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="chapter-ggplot2.html#cb624-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg_1, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cyl), <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb624-2"><a href="chapter-ggplot2.html#cb624-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb624-3"><a href="chapter-ggplot2.html#cb624-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(am)) <span class="sc">+</span></span>
<span id="cb624-4"><a href="chapter-ggplot2.html#cb624-4" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Number of Cylinders&quot;</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-29-3"></span>
<img src="_main_files/figure-html/5-29-3-1.png" alt="그룹 변수가 두 개인 나란히 서 있는 상자그림" width="576" />
<p class="caption">
그림 5.56: 그룹 변수가 두 개인 나란히 서 있는 상자그림
</p>
</div>
</div>
<div id="좌표계-coordinate-system" class="section level2 hasAnchor" number="5.7">
<h2><span class="header-section-number">5.7</span> 좌표계: Coordinate system<a href="chapter-ggplot2.html#좌표계-coordinate-system" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>좌표계는 시각적 위치 요소인 <code>x</code>와 <code>y</code>를 근거로 그래프 각 요소의 2차원 위치를 결정하는 체계이다.
디폴트 좌표계는 데카르트 좌표계인 <code>coord_cartesian()</code>이며, 그 외에 활용도가
높은 좌표계로 <code>coord_flip()</code>과 <code>coord_polar()</code>가 있다.</p>
<ul>
<li><code>coord_cartesian()</code>의 활용: XY축 범위 조정</li>
</ul>
<p>함수 <code>coord_cartesian()</code>은 <code>xlim</code>과 <code>ylim</code>으로 그래프의 XY축의 범위를 조정하는 기능이 있다.
원래 XY축의 조정은 <code>ggplot2</code>에서 실행되는 Grammar of graphics 성분 중 scale이 담당하는 영역이다.
Scale이란 자료와 시각적 요소와의 매핑 및 XY축과 범례 등의 내용 조정을 의미한다.
대부분의 경우에는 디폴트 상태에서 그래프를 작성하지만, XY축의 범위나 XY축의 라벨 등을 변경해야 한다면,
scale의 디폴트 값을 수정해야 한다.</p>
<p>예를 들어 데이터 프레임 <code>mpg</code>의 변수 <code>displ</code>과 <code>hwy</code>의 산점도에 비모수 회귀곡선을 추가한 그래프의 X축 범위를 (3,6)으로 축소시켜보자.
Scale 함수는 <code>scale_*1*_*2*()</code>의 형태를 취하고 있는데,
<code>*1*</code>은 수정하고자 하는 시각적 요소를 지정하는 것으로써 <code>color</code>, <code>x</code>, <code>y</code>, <code>fill</code> 등이 가능하고,
<code>*2*</code>는 적용되는 <code>scale</code>을 지칭하는 것으로 <code>discrete</code>, <code>continuous</code> 등이 가능하다.
따라서 연속형 변수 <code>displ</code>과 연결된 시각적 요소 <code>x</code>의 범위를 (3,6)으로 수정하기 위해서는
함수 <code>scale_x_continuous(limits = c(3, 6))</code>을 추가해야 한다.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="chapter-ggplot2.html#cb625-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg,  <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb625-2"><a href="chapter-ggplot2.html#cb625-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb625-3"><a href="chapter-ggplot2.html#cb625-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="chapter-ggplot2.html#cb626-1" tabindex="-1"></a>p <span class="sc">+</span> </span>
<span id="cb626-2"><a href="chapter-ggplot2.html#cb626-2" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-30-1"></span>
<img src="_main_files/figure-html/5-30-1-1.png" alt="'scale'로 X축 범위 축소" width="576" />
<p class="caption">
그림 5.57: ’scale’로 X축 범위 축소
</p>
</div>
<p>이러한 XY축의 범위 조정은 상당히 흔한 작업이기 때문에 간편하게 <code>scale</code>의 디폴트 값을 수정할 수 있도록
함수 <code>xlim()</code>과 <code>ylim()</code>이 만들어졌다. 즉 위의 예제는 <code>p + xlim(3,6)</code>을 실행해도 동일한 그래프를 작성할 수 있다.</p>
<p>Scale 함수를 사용하여 XY축 범위를 축소한 경우, 조심해야 할 점은 범위를 벗어난 자료들이 모두 <code>NA</code>로 바뀐다는 것이다.
따라서 그림 <a href="chapter-ggplot2.html#fig:5-30-1">5.57</a>는 범위를 벗어난 105개 자료가 삭제된 상태에서 작성된 그래프이다.
이에 반하여 XY축 범위를 함수 <code>coord_cartesian()</code>으로 축소하면, 전체 그래프 중 축소된 범위에 해당되는 부분만 확대해서 보여주는 것으로써 범위를 벗어난 자료를 삭제하지는 않는다.</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="chapter-ggplot2.html#cb627-1" tabindex="-1"></a>p <span class="sc">+</span> </span>
<span id="cb627-2"><a href="chapter-ggplot2.html#cb627-2" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb627-3"><a href="chapter-ggplot2.html#cb627-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Engine Displacement&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-30-2"></span>
<img src="_main_files/figure-html/5-30-2-1.png" alt="함수 `coord_cartesian()`으로 X축 범위 축소" width="576" />
<p class="caption">
그림 5.58: 함수 <code>coord_cartesian()</code>으로 X축 범위 축소
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-30-2">5.58</a>는 X축 라벨의 디폴트 값이 수정되었는데, 축의 라벨 수정도 상당히 흔한
작업이기 때문에 함수 <code>scale_x_continuous(name = "Engine Displacement")</code>을 실행시키는 대신 함수 <code>xlab()</code>으로 간편하게 수정할 수 있다. 또한 함수 <code>labs()</code>을 사용하면 X축, Y축 라벨 수정 및 그래프 제목, 범례의 제목 등도 수정할 수 있다.</p>
<ul>
<li><code>coord_flip()</code>의 활용: XY축 좌표 90<sup>°</sup> 회전</li>
</ul>
<p><code>ggplot2</code>의 이전 버전에서는 대부분의 <code>geom</code> 함수가 주어진 <code>x</code>에 대한 <code>y</code>의 분포 등을
나타내는데 중점을 두고 있었다.
따라서 나란히 서 있는 상자그림은 그룹을 구성하는 <code>x</code> 변수의 개별 값에 대하여 연속형 <code>y</code> 변수의 상자그림이 수직방향으로 작성되는 것이 디폴트 형태가 되었고,
나란히 서 있는 상자그림을 수평방향으로 작성하고자 한다면, 수직방향으로 그래프를
작성하고, 작성된 그래프의 좌표를 함수 <code>coord_flip()</code>으로 90<sup>°</sup> 회전시켜야 했다.</p>
<p>그러나 최근 버전에는 <code>y</code> 변수를 조건 변수로 지정하는 것이 가능하게 되었고,
따라서 수평 방향의 상자그림을 작성하기 위해 굳이 함수 <code>coord_flip()</code>을 사용할 필요는 없어졌다.</p>
<p>데이터 프레임 <code>mpg</code>에서 변수 <code>class</code>의 그룹별로 <code>hwy</code>의 상자그림을 작성해 보자.
우선 조건 변수 <code>class</code>를 <code>x</code> 변수로 사용하는 경우이다.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="chapter-ggplot2.html#cb628-1" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb628-2"><a href="chapter-ggplot2.html#cb628-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb628-3"><a href="chapter-ggplot2.html#cb628-3" tabindex="-1"></a>p1</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-31-1"></span>
<img src="_main_files/figure-html/5-31-1-1.png" alt="수직방향의 나란히 서 있는 상자그림" width="576" />
<p class="caption">
그림 5.59: 수직방향의 나란히 서 있는 상자그림
</p>
</div>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="chapter-ggplot2.html#cb629-1" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-31-2"></span>
<img src="_main_files/figure-html/5-31-2-1.png" alt="수평방향의 나란히 서 있는 상자그림" width="576" />
<p class="caption">
그림 5.60: 수평방향의 나란히 서 있는 상자그림
</p>
</div>
<p>그림 <a href="chapter-ggplot2.html#fig:5-31-2">5.60</a>는 다음과 같이 조건 변수 <code>class</code>를 <code>y</code> 변수로 사용해서 작성할 수 있다.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="chapter-ggplot2.html#cb630-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> hwy, <span class="at">y =</span> class)) <span class="sc">+</span></span>
<span id="cb630-2"><a href="chapter-ggplot2.html#cb630-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p>또한 그림 <a href="chapter-ggplot2.html#fig:5-31-1">5.59</a>는 <code>class</code>를 <code>y</code> 변수로 지정하고 함수 <code>coord_flip()</code>을 다음과 같이 사용해서 작성할 수 있다.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="chapter-ggplot2.html#cb631-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> hwy, <span class="at">y =</span> class)) <span class="sc">+</span></span>
<span id="cb631-2"><a href="chapter-ggplot2.html#cb631-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb631-3"><a href="chapter-ggplot2.html#cb631-3" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p>한 변수의 상자그림을 작성하는 경우에도 함수 <code>geom_boxplot()</code>에는 시각적 요소 <code>x</code>와 <code>y</code> 모두가 필요하다.
수직 방향으로 작성하는 경우에는 시각적 요소 <code>y</code>에 상자그림 작성 대상이 되는 연속형 변수를 연결하고,
<code>x</code>에는 임의의 문자열을 매핑하면 된다.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="chapter-ggplot2.html#cb632-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb632-2"><a href="chapter-ggplot2.html#cb632-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb632-3"><a href="chapter-ggplot2.html#cb632-3" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-32-1"></span>
<img src="_main_files/figure-html/5-32-1-1.png" alt="수직방향 상자그림" width="576" />
<p class="caption">
그림 5.61: 수직방향 상자그림
</p>
</div>
<p>수평방향 상자그림은 <code>x</code>에는 연속형 변수, <code>y</code>에는 임의의 문자열을 매핑하면 된다.</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="chapter-ggplot2.html#cb633-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> hwy, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)) <span class="sc">+</span></span>
<span id="cb633-2"><a href="chapter-ggplot2.html#cb633-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb633-3"><a href="chapter-ggplot2.html#cb633-3" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-32-2"></span>
<img src="_main_files/figure-html/5-32-2-1.png" alt="수평방향 상자그림" width="576" />
<p class="caption">
그림 5.62: 수평방향 상자그림
</p>
</div>
<ul>
<li><code>coord_polar()</code>의 활용: 파이 그래프 작성</li>
</ul>
<p>극좌표는 2차원 공간에 있는 어느 한 점의 위치를 원점에서의 거리와 각도로 나타내는 좌표계이다.
디폴트 좌표계인 데카르트 좌표를 극좌표로 전환하려면 함수 <code>coord_polar()</code>을
사용하면 되는데, 시각적 요소 <code>x</code>와 <code>y</code> 중 각도로 전환할 요소를 변수 <code>theta</code>에 지정해야 하며,
디폴트는 <code>theta = "x"</code>이다.</p>
<p>극좌표의 활용 예제로 Coxcomb 또는 Wind rose라고 불리는 그래프를 작성해 보자.
우선 데이터 프레임 <code>mpg</code>의 변수 <code>class</code>의 막대 그래프를 작성하되, 막대 사이의 간격을 없애고 범례를 제거해 보자.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="chapter-ggplot2.html#cb634-1" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb634-2"><a href="chapter-ggplot2.html#cb634-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb634-3"><a href="chapter-ggplot2.html#cb634-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb634-4"><a href="chapter-ggplot2.html#cb634-4" tabindex="-1"></a>b1</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-33-1"></span>
<img src="_main_files/figure-html/5-33-1-1.png" alt="Coxcomb 그래프 작성을 위한 막대 그래프" width="576" />
<p class="caption">
그림 5.63: Coxcomb 그래프 작성을 위한 막대 그래프
</p>
</div>
<p>함수 <code>geom_bar()</code>에 사용된 옵션 <code>show.legend = FALSE</code>는 범례를 제거하기 위한 것이며,
<code>width = 1</code>은 막대 사이의 간격을 제거하기 위한 것이다. 변수 <code>width</code>는 막대 폭을 지정하는
것으로 구간의 90%를 차지하는 0.9가 디폴트 값이다.
이제 작성된 막대 그래프에 극좌표를 적용시켜 보자.</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="chapter-ggplot2.html#cb635-1" tabindex="-1"></a>b1 <span class="sc">+</span> <span class="fu">coord_polar</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-33-2"></span>
<img src="_main_files/figure-html/5-33-2-1.png" alt="극좌표를 이용하여 막대 그래프를 Coxcomb 그래프로 변환" width="576" />
<p class="caption">
그림 5.64: 극좌표를 이용하여 막대 그래프를 Coxcomb 그래프로 변환
</p>
</div>
<p>각도 <code>theta</code>에 디폴트인 <code>x</code>가 적용됐다. 따라서 동일한 막대 폭이 각도로 변환되어서 각 조각이 같은 크기의 각도를 유지하고 있고, 서로 다른 막대의 높이가 각 조각의 반지름으로 변환된 Coxcomb 그래프가 작성되었다.</p>
<p>극좌표 활용의 두 번째 예제로 파이 그래프와 Bullseye 그래프를 작성해 보자.
이 경우에도 막대 그래프를 작성하고 극좌표를 적용하는 것인데, 막대 그래프를 위로 쌓아 올리는
형태로 작성해야 한다. 한 변수에 대한 막대 그래프를 쌓아 올리기 위해서는 시각적 요소
<code>x</code>에 임의의 문자열을 매핑하고 범주형 변수를 시각적 요소 <code>fill</code>에 매핑해야 한다.
또한 X축 전체 구간을 막대로 가득 채우기 위해 <code>width = 1</code>을 추가해야 한다.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="chapter-ggplot2.html#cb636-1" tabindex="-1"></a>b2 <span class="ot">&lt;-</span>  <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> class)) <span class="sc">+</span></span>
<span id="cb636-2"><a href="chapter-ggplot2.html#cb636-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb636-3"><a href="chapter-ggplot2.html#cb636-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb636-4"><a href="chapter-ggplot2.html#cb636-4" tabindex="-1"></a>b2</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-34-1"></span>
<img src="_main_files/figure-html/5-34-1-1.png" alt="파이 그래프 작성을 위한 막대 그래프" width="576" />
<p class="caption">
그림 5.65: 파이 그래프 작성을 위한 막대 그래프
</p>
</div>
<p>작성된 막대 그래프에 극좌표를 적용하면서 각도 <code>theta</code>에 디폴트인 <code>"x"</code>가 지정되면 전체 구간에 해당되는 360°가
모든 그룹에 적용되어 Bullseye 그래프가 작성된다.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="chapter-ggplot2.html#cb637-1" tabindex="-1"></a>b2 <span class="sc">+</span> <span class="fu">coord_polar</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-34-2"></span>
<img src="_main_files/figure-html/5-34-2-1.png" alt="극좌표를 이용하여 막대 그래프를 Bullseye 그래프로 변환" width="576" />
<p class="caption">
그림 5.66: 극좌표를 이용하여 막대 그래프를 Bullseye 그래프로 변환
</p>
</div>
<p>반면에 <code>theta</code>에 <code>"y"</code>를 지정하면 각 그룹의 상대도수에 비례하여 각도가 정해져서 파이 그래프가 작성된다.</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="chapter-ggplot2.html#cb638-1" tabindex="-1"></a>b2 <span class="sc">+</span> <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-34-3"></span>
<img src="_main_files/figure-html/5-34-3-1.png" alt="극좌표를 이용하여 막대 그래프를 파이 그래프로 변환" width="576" />
<p class="caption">
그림 5.67: 극좌표를 이용하여 막대 그래프를 파이 그래프로 변환
</p>
</div>
<p>XY축을 제거하면 조금 더 깔끔한 파이 그래프를 작성할 수 있다.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="chapter-ggplot2.html#cb639-1" tabindex="-1"></a>b2 <span class="sc">+</span> </span>
<span id="cb639-2"><a href="chapter-ggplot2.html#cb639-2" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb639-3"><a href="chapter-ggplot2.html#cb639-3" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:5-34-4"></span>
<img src="_main_files/figure-html/5-34-4-1.png" alt="극좌표를 이용하여 막대 그래프를 파이 그래프로 변환" width="576" />
<p class="caption">
그림 5.68: 극좌표를 이용하여 막대 그래프를 파이 그래프로 변환
</p>
</div>
<p>함수 <code>coord_polar()</code>를 활용하여 파이 그래프의 작성방법을 살펴보았으나,
사실 파이 그래프와 같이 면적의 차이로 그룹 간의 도수를 비교해야 하는 그래프는 가능한 사용하지
않는 것이 좋다. 그것은 사람들이 길이의 차이는 비교적 정확하게 분별할 수 있으나,
면적의 차이를 정확하게 구분하는 것이 쉽지 않기 때문이다.
좋은 그래프란 갖고 있는 정보를 신속하고도 정확하게 인지할 수 있는 그래프를 의미하는 것이고,
그런 의미에서 파이 그래프를 좋은 그래프라고 할 수는 없을 것이다.</p>
<ul>
<li><code>ggplot2</code>의 기본 요소</li>
</ul>
<p>지금까지 살펴본 <code>ggplot2</code>에서 그래프를 작성하는 기본 요소를 정리해 보면 다음과 같다.</p>
<pre><code>ggplot(data = &lt;Data&gt;) +
  &lt;Geom_Function&gt;(mapping = aes(&lt;Mappings&gt;), stat = &lt;Stat&gt;,
                  position = &lt;Position&gt;) +
  &lt;Coord_Function&gt; +
  &lt;Facet_Function&gt;</code></pre>
<p><code>ggplot2</code>는 <code>base graphics</code>보다 여러 면에서 개선된 그래프 작성 시스템이다.
특히 빅데이터 시대에 요청되는 다양한 그래픽스를 비교적 간편하게 작성할 수 있기 때문에 앞으로
한층 더 주목을 받게 될 것이다.</p>
<p>이 장에서는 <code>ggplot2</code>의 기본 개념에 대하여 살펴보았다.
일변량 혹은 이변량 자료 탐색 과정을 포함한 다양한 상황에서의 ggplot2의 활용 방안에 대해서는 <a href="chapter-EDA.html#chapter-EDA">9</a>장에서 자세하게 소개할 것이다.</p>
</div>
<div id="연습문제-3" class="section level2 hasAnchor" number="5.8">
<h2><span class="header-section-number">5.8</span> 연습문제<a href="chapter-ggplot2.html#연습문제-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>1.</strong> <code>mtcars</code>는 1974년에 발간된 ’Motor Trend US’라는 잡지에 있는 32대 자동차에 대한 자료가 입력되어 있는 데이터 프레임이다.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="chapter-ggplot2.html#cb641-1" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb641-2"><a href="chapter-ggplot2.html#cb641-2" tabindex="-1"></a><span class="do">##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span id="cb641-3"><a href="chapter-ggplot2.html#cb641-3" tabindex="-1"></a><span class="do">## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span id="cb641-4"><a href="chapter-ggplot2.html#cb641-4" tabindex="-1"></a><span class="do">## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span id="cb641-5"><a href="chapter-ggplot2.html#cb641-5" tabindex="-1"></a><span class="do">## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span id="cb641-6"><a href="chapter-ggplot2.html#cb641-6" tabindex="-1"></a><span class="do">## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span id="cb641-7"><a href="chapter-ggplot2.html#cb641-7" tabindex="-1"></a><span class="do">## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span id="cb641-8"><a href="chapter-ggplot2.html#cb641-8" tabindex="-1"></a><span class="do">## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span></code></pre></div>
<ul>
<li>변수 <code>qsec</code>은 정지 상태에서 출발하여 0.25마일에 도달할 때까지 걸린 시간을 나타내는 변수이고, <code>mpg</code>는 연비를 나타내는 변수이다. 두 변수의 산점도를 다음과 같이 작성하라.</li>
</ul>
<p><img src="_main_files/figure-html/unnamed-chunk-584-1.png" width="576" /></p>
<ul>
<li>변수 <code>am</code>은 차량의 변속기 종류를 나타내는 변수이다. <code>qsec</code>과 <code>mpg</code>의 산점도를 작성하되 <code>am</code>의 값에 따라 점의 색이 구분되도록 하라.</li>
</ul>
<p><img src="_main_files/figure-html/unnamed-chunk-585-1.png" width="576" /></p>
<ul>
<li>변수 <code>am</code>에 대한 막대그래프를 작성하라. 막대그래프의 색은 <code>steelblue</code>이다.</li>
</ul>
<p><img src="_main_files/figure-html/unnamed-chunk-586-1.png" width="576" /></p>
<ul>
<li>변수 <code>qsec</code>과 <code>mpg</code>의 산점도를 작성하되, <code>mpg</code>의 값이 가장 큰 차량의 행 이름을 해당 점 옆에 다음과 같이 표시하라.</li>
</ul>
<p><img src="_main_files/figure-html/unnamed-chunk-587-1.png" width="576" /></p>
<p><strong>2.</strong> 데이터 프레임 <code>airquality</code> 는 New York city 의 오존 농도에 관한 데이터이다.</p>
<ul>
<li>변수 <code>Ozone</code>과 <code>Solar.R</code>에는 많은 결측값이 있다. 두 변수 중 한 변수라도 결측값이 있는 날수를 월별로 나타내는 다음의 그래프를 작성해 보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-1-1-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>월별로 변수 <code>Ozone</code>과 <code>Solar.R</code>의 산점도에 회귀직선을 추가한 다음의 그래프를 작성해 보자.
결측값이 지나치게 많은 6월 자료는 대상에서 제외한다.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-1-2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><strong>3.</strong> 패키지 <code>ggplot2</code>에 있는 데이터 프레임 <code>mpg</code>에는 1999년과 2008년에 많이 판매됐던 38 종류 자동차에 대한 11개 변수가 입력되어 있다.</p>
<ul>
<li>11개 변수 중 문자형 변수만 선택해서 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 234 × 6
##   manufacturer model trans      drv   fl    class  
##   &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
## 1 audi         a4    auto(l5)   f     p     compact
## 2 audi         a4    manual(m5) f     p     compact
## 3 audi         a4    manual(m6) f     p     compact
## # ℹ 231 more rows</code></pre>
<ul>
<li>문자형 변수 중 manufacturer, model을 제외한 나머지 변수를 모두 요인으로 변경시켜서 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 234 × 6
##   manufacturer model trans      drv   fl    class  
##   &lt;chr&gt;        &lt;chr&gt; &lt;fct&gt;      &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  
## 1 audi         a4    auto(l5)   f     p     compact
## 2 audi         a4    manual(m5) f     p     compact
## 3 audi         a4    manual(m6) f     p     compact
## # ℹ 231 more rows</code></pre>
<ul>
<li>요인으로 변경된 변수 <code>trans</code>의 범주별 빈도를 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 10 × 2
##    trans          n
##    &lt;fct&gt;      &lt;int&gt;
##  1 auto(av)       5
##  2 auto(l3)       2
##  3 auto(l4)      83
##  4 auto(l5)      39
##  5 auto(l6)       6
##  6 auto(s4)       3
##  7 auto(s5)       3
##  8 auto(s6)      16
##  9 manual(m5)    58
## 10 manual(m6)    19</code></pre>
<ul>
<li>변수 <code>trans</code>의 범주 중 <code>manual(m5)</code>와 <code>manual(m6)</code>는 <code>Manual</code>로 통합하고, <code>auto(l3)</code>, <code>auto(l4)</code>, <code>auto(l5)</code>, <code>auto(l6)</code>는 <code>Auto-T1</code>으로, 나머지 범주는 <code>Auto-T2</code>로 통합해서 각 범주의 빈도를 다음과 같이 막대 그래프로 나타내 보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-1-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>3개 범주로 통합한 변수 <code>trans</code>와 변수 <code>cyl</code>의 관계를 알아보고자 한다. 변수 <code>cyl</code>에서 <code>5</code>의 값을 갖는 자동차 자료는 제외한다. 다음과 같은 3 종류의 막대 그래프를 작성하고, 두 변수의 관계를 설명해 보자.
세 번째 그래프는 상대도수에 의한 막대 그래프이다.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><img src="_main_files/figure-html/ggplot-ex-2-3-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><img src="_main_files/figure-html/ggplot-ex-2-4-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>변수 <code>cyl</code>과 <code>hwy</code>의 관계를 알아보고자 한다. 다음의 그래프를 작성하고, 두 변수의 관계를 설명해 보자. 변수 <code>cyl</code>에서 <code>5</code>의 값을 갖는 자동차 자료는 제외한다.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-5-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>변수 <code>cyl</code>, <code>drv</code>와 <code>hwy</code>의 관계를 알아보고자 한다. 다음의 두 가지 그래프를 작성하고, 세 변수의 관계를 설명해 보자. 변수 <code>cyl</code>에서 <code>5</code>의 값을 갖는 자동차 자료는 제외하며, 변수 <code>drv</code>에서 <code>4</code>는 <code>4WD</code>로 라벨을 변경하고, <code>f</code>와 <code>r</code>은 통합해서 <code>F or R</code>로 라벨을 변경한다.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-6-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><img src="_main_files/figure-html/ggplot-ex-2-7-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>변수 <code>hwy</code>와 <code>cty</code>의 차이가 가장 큰 자동차와 가장 작은 자동차의 manufacturer, model, cty, hwy의 값을 다음과 같이 각각 출력해 보자. 두 그룹에 속한 자동차들 사이에 두드러진 차이가 무엇인지 설명해 보자.</li>
</ul>
<pre><code>## # A tibble: 2 × 4
##   manufacturer model        cty   hwy
##   &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt; &lt;int&gt;
## 1 honda        civic         24    36
## 2 volkswagen   new beetle    29    41</code></pre>
<pre><code>## # A tibble: 3 × 4
##   manufacturer model               cty   hwy
##   &lt;chr&gt;        &lt;chr&gt;             &lt;int&gt; &lt;int&gt;
## 1 nissan       pathfinder 4wd       15    17
## 2 toyota       4runner 4wd          15    17
## 3 toyota       toyota tacoma 4wd    15    17</code></pre>
<ul>
<li>변수 <code>displ</code>과 <code>hwy</code>의 산점도를 작성하되, 변수 <code>hwy</code>와 <code>cty</code>의 차이가 가장 큰 자동차에 해당하는 점에는 빨간 색으로 변수 manufacturer, model의 값을 라벨로 표시하고, 변수 <code>hwy</code>와 <code>cty</code>의 차이가 가장 작은 자동차에 해당하는 점에는 파란 색으로 변수 manufacturer, model의 값을 라벨로 표시해 보자.
라벨이 겹치는 경우에는 하나만 표시한다.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-8-1.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>변수 <code>hwy</code>와 <code>cty</code>의 평균값을 새로운 변수 <code>avg_mpg</code>에 할당하고, 그 값이 가장 큰 자동차의 manufacturer, model, cty, hwy의 값을 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 1 × 4
##   manufacturer model        cty   hwy
##   &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt; &lt;int&gt;
## 1 volkswagen   new beetle    35    44</code></pre>
<ul>
<li>변수 <code>displ</code>과 <code>avg_mpg</code>의 산점도를 작성하되, <code>avg_mpg</code>이 값이 가장 큰 세 대의 자동차에 해당하는 점에는 변수 manufacturer, model의 값을 라벨로 다음과 같이 표시해 보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-9-1.png" width="768" style="display: block; margin: auto;" /></p>
<ul>
<li>변수 <code>displ</code>과 <code>avg_mpg</code>의 산점도에 비모수 회귀곡선과 선형회귀직선을 추가해 보자. 비모수 회귀곡선은 모든 자료를 사용해서 구하지만, 선형회귀직선은 앞 문제 산점도에 라벨이 표시된 3개의 점을 제외하고 추정한다. 범례도 함께 표시해서 다음과 같이 작성해 보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-2-10-1.png" width="768" style="display: block; margin: auto;" /></p>
<p><strong>4.</strong> 패키지 <code>MASS</code>에 있는 데이터 프레임 <code>Cars93</code>는 1993년 미국에서 판매된 93 종류의 자동차에 대한 데이터로 27개 변수로 구성되어 있다.</p>
<ul>
<li>모든 변수의 처음 3 케이스를 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 93 × 27
##   Manufacturer Model   Type    Min.Price Price Max.Price MPG.city MPG.highway
##   &lt;fct&gt;        &lt;fct&gt;   &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt;       &lt;int&gt;
## 1 Acura        Integra Small        12.9  15.9      18.8       25          31
## 2 Acura        Legend  Midsize      29.2  33.9      38.7       18          25
## 3 Audi         90      Compact      25.9  29.1      32.3       20          26
##   AirBags            DriveTrain Cylinders EngineSize Horsepower   RPM
##   &lt;fct&gt;              &lt;fct&gt;      &lt;fct&gt;          &lt;dbl&gt;      &lt;int&gt; &lt;int&gt;
## 1 None               Front      4                1.8        140  6300
## 2 Driver &amp; Passenger Front      6                3.2        200  5500
## 3 Driver only        Front      6                2.8        172  5500
##   Rev.per.mile Man.trans.avail Fuel.tank.capacity Passengers Length Wheelbase
##          &lt;int&gt; &lt;fct&gt;                        &lt;dbl&gt;      &lt;int&gt;  &lt;int&gt;     &lt;int&gt;
## 1         2890 Yes                           13.2          5    177       102
## 2         2335 Yes                           18            5    195       115
## 3         2280 Yes                           16.9          5    180       102
##   Width Turn.circle Rear.seat.room Luggage.room Weight Origin  Make         
##   &lt;int&gt;       &lt;int&gt;          &lt;dbl&gt;        &lt;int&gt;  &lt;int&gt; &lt;fct&gt;   &lt;fct&gt;        
## 1    68          37           26.5           11   2705 non-USA Acura Integra
## 2    71          38           30             15   3560 non-USA Acura Legend 
## 3    67          37           28             14   3375 non-USA Audi 90      
## # ℹ 90 more rows</code></pre>
<ul>
<li>변수 중 요인만 선택해서 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 93 × 9
##   Manufacturer Model   Type    AirBags            DriveTrain Cylinders
##   &lt;fct&gt;        &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;              &lt;fct&gt;      &lt;fct&gt;    
## 1 Acura        Integra Small   None               Front      4        
## 2 Acura        Legend  Midsize Driver &amp; Passenger Front      6        
## 3 Audi         90      Compact Driver only        Front      6        
##   Man.trans.avail Origin  Make         
##   &lt;fct&gt;           &lt;fct&gt;   &lt;fct&gt;        
## 1 Yes             non-USA Acura Integra
## 2 Yes             non-USA Acura Legend 
## 3 Yes             non-USA Audi 90      
## # ℹ 90 more rows</code></pre>
<ul>
<li><p>변수 Manufacturer, Model 은 자동차 제조 회사의 이름과 자동차 모델 이름이 각각 입력되어 있다.
93대 자동차의 제조 회사 중 빈도가 가장 높은 상위 5개 회사를 구해보자.
현대 자동차의 경우에는 어떤 모델의 자동차가 판매되었는지 알아보자.</p></li>
<li><p>요인 중 변수 Manufacturer, Model, Make는 제외하고 나머지 요인들의 수준의 개수를 확인해서 다음과 같이 출력해 보자.</p></li>
</ul>
<pre><code>##   Type AirBags DriveTrain Cylinders Man.trans.avail Origin
## 1    6       3          3         6               2      2</code></pre>
<ul>
<li>변수 <code>Cylinders</code>와 <code>Origin</code>의 범주별 빈도를 다음과 같이 각각 구해보자.</li>
</ul>
<pre><code>##   Cylinders  n
## 1         3  3
## 2         4 49
## 3         5  2
## 4         6 31
## 5         8  7
## 6    rotary  1</code></pre>
<pre><code>##    Origin  n
## 1     USA 48
## 2 non-USA 45</code></pre>
<ul>
<li>변수 <code>Cylinders</code>의 6개 범주 중 빈도가 낮은 3개 범주는 제외하고 막대 그래프를 작성하되, 각 범주의 빈도를 다음과 같이 그래프에 함께 나타내보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-3-1-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>범주형 변수 <code>Cylinders</code>와 <code>Origin</code>의 관계를 알아보고자 한다.
변수 <code>Cylinders</code>의 6개 범주 중 빈도가 낮은 3개 범주는 제외하고 다음 두 그래프를 작성한다.<br />
또한 두 변수의 관계를 설명해 보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-3-2-1.png" width="576" style="display: block; margin: auto;" /></p>
<p><img src="_main_files/figure-html/ggplot-ex-3-3-1.png" width="576" style="display: block; margin: auto;" /></p>
<ul>
<li>모든 숫자형 변수의 평균을 계산해서 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>##                           Mean
## Min.Price            17.125806
## Price                19.509677
## Max.Price            21.898925
## MPG.city             22.365591
## MPG.highway          29.086022
## EngineSize            2.667742
## Horsepower          143.827957
## RPM                5280.645161
## Rev.per.mile       2332.204301
## Fuel.tank.capacity   16.664516
## Passengers            5.086022
## Length              183.204301
## Wheelbase           103.946237
## Width                69.376344
## Turn.circle          38.956989
## Rear.seat.room              NA
## Luggage.room                NA
## Weight             3072.903226</code></pre>
<ul>
<li>결측값이 있는 변수만을 대상으로 자료에 포함된 결측값의 개수와 결측값을 제외한 평균값을 각각 계산해서 다음과 같이 출력해 보자.</li>
</ul>
<pre><code>##   Rear.seat.room_Mean Rear.seat.room_Num.NA Luggage.room_Mean
## 1            27.82967                     2          13.89024
##   Luggage.room_Num.NA
## 1                  11</code></pre>
<ul>
<li><p>범주형 변수인 <code>Cylinders</code>와 숫자형 변수 <code>Price</code>의 관계를 알아보고자 한다.
변수 <code>Cylinders</code>의 6개 범주 중 빈도가 낮은 3개 범주는 제외하고 두 변수의 관계를 가장 잘 나타내는 그래프를 작성해 보자.
또한 두 변수의 관계를 설명해 보자.</p></li>
<li><p>차량의 가격에 대한 변수 중 <code>Max.Price</code>와 <code>Min.Price</code>가 있다.
두 변수의 차이와 변수 <code>Price</code>의 산점도를 작성해 보자. 산점도에 두 변수의 차이가 가장 큰 자동차의 Manufacturer, Model 값을 해당 점 주변에 다음과 같이 표시해 보자.</p></li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-3-4-1.png" width="864" /></p>
<ul>
<li>두 숫자형 변수인 <code>Price</code>와 <code>MPG.city</code>의 관계를 살펴보고자 한다.
두 변수의 산점도를 작성하되, <code>Price</code>의 값이 지나치게 높은 두 자동차와 <code>MPG.city</code>의 값이 상당히 큰 세 자동차의 Manufacturer, Model 값을 산점도에 다음과 같이 함께 표시해 보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-3-5-1.png" width="864" /></p>
<ul>
<li>변수 <code>Price</code>와 <code>MPG.city</code>의 산점도를 다시 작성하되, 12)번 문제에서 작성된 두 변수의 산점도에서 라벨이 부착된 5개 점을 제외한 나머지 자료를 대상으로 비모수 회귀곡선과 선형회귀직선을 각각 추정해서 다음과 같이 그래프에 범례와 함께 나타내보자.</li>
</ul>
<p><img src="_main_files/figure-html/ggplot-ex-3-6-1.png" width="864" /></p>
<p><strong>5.</strong> 패키지 <code>ggplot2</code>의 데이터 프레임 <code>mpg</code>와 패키지 <code>MASS</code>의 데이터 프레임 <code>Cars93</code>는 자동차 연비와 관련된 자료가 입력되어 있다.</p>
<ul>
<li><code>Cars93</code>에서 변수 <code>Manufacturer</code>, <code>Man.trans.avail</code>, <code>MPG.highway</code>, <code>EngineSize</code>, <code>Cylinders</code>을 선택해서 데이터 프레임 <code>cars_93</code>에 입력하라. <code>mpg</code>에서는 변수 <code>manufacturer</code>, <code>trans</code>, <code>hwy</code>, <code>displ</code>, <code>cyl</code>을 선택하되, 변수 <code>year</code>가 <code>1999</code>인 케이스만 선택해서 데이터 프레임 <code>cars_99</code>에 입력하라. 두 데이터 프레임의 첫 세 케이스의 출력 결과는 다음과 같다.</li>
</ul>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="chapter-ggplot2.html#cb655-1" tabindex="-1"></a>cars_93 <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb655-2"><a href="chapter-ggplot2.html#cb655-2" tabindex="-1"></a><span class="do">## # A tibble: 93 × 5</span></span>
<span id="cb655-3"><a href="chapter-ggplot2.html#cb655-3" tabindex="-1"></a><span class="do">##   Manufacturer Man.trans.avail MPG.highway EngineSize Cylinders</span></span>
<span id="cb655-4"><a href="chapter-ggplot2.html#cb655-4" tabindex="-1"></a><span class="do">##   &lt;fct&gt;        &lt;fct&gt;                 &lt;int&gt;      &lt;dbl&gt; &lt;fct&gt;    </span></span>
<span id="cb655-5"><a href="chapter-ggplot2.html#cb655-5" tabindex="-1"></a><span class="do">## 1 Acura        Yes                      31        1.8 4        </span></span>
<span id="cb655-6"><a href="chapter-ggplot2.html#cb655-6" tabindex="-1"></a><span class="do">## 2 Acura        Yes                      25        3.2 6        </span></span>
<span id="cb655-7"><a href="chapter-ggplot2.html#cb655-7" tabindex="-1"></a><span class="do">## 3 Audi         Yes                      26        2.8 6        </span></span>
<span id="cb655-8"><a href="chapter-ggplot2.html#cb655-8" tabindex="-1"></a><span class="do">## # ℹ 90 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="chapter-ggplot2.html#cb656-1" tabindex="-1"></a>cars_99 <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb656-2"><a href="chapter-ggplot2.html#cb656-2" tabindex="-1"></a><span class="do">## # A tibble: 117 × 5</span></span>
<span id="cb656-3"><a href="chapter-ggplot2.html#cb656-3" tabindex="-1"></a><span class="do">##   manufacturer trans        hwy displ   cyl</span></span>
<span id="cb656-4"><a href="chapter-ggplot2.html#cb656-4" tabindex="-1"></a><span class="do">##   &lt;chr&gt;        &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb656-5"><a href="chapter-ggplot2.html#cb656-5" tabindex="-1"></a><span class="do">## 1 audi         auto(l5)      29   1.8     4</span></span>
<span id="cb656-6"><a href="chapter-ggplot2.html#cb656-6" tabindex="-1"></a><span class="do">## 2 audi         manual(m5)    29   1.8     4</span></span>
<span id="cb656-7"><a href="chapter-ggplot2.html#cb656-7" tabindex="-1"></a><span class="do">## 3 audi         auto(l5)      26   2.8     6</span></span>
<span id="cb656-8"><a href="chapter-ggplot2.html#cb656-8" tabindex="-1"></a><span class="do">## # ℹ 114 more rows</span></span></code></pre></div>
<ul>
<li><code>cars_93</code>과 <code>cars_99</code>의 변수들은 이름은 다르지만, 동일한 내용의 변수들이 순서대로 나열되어 있다. <code>cars_93</code>의 변수 이름을 <code>cars_99</code>의 변수 이름과 같아지도록 변경해 보자. 변경된 결과는 다음과 같다.</li>
</ul>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="chapter-ggplot2.html#cb657-1" tabindex="-1"></a>cars_93 <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb657-2"><a href="chapter-ggplot2.html#cb657-2" tabindex="-1"></a><span class="do">## # A tibble: 93 × 5</span></span>
<span id="cb657-3"><a href="chapter-ggplot2.html#cb657-3" tabindex="-1"></a><span class="do">##   manufacturer trans   hwy displ cyl  </span></span>
<span id="cb657-4"><a href="chapter-ggplot2.html#cb657-4" tabindex="-1"></a><span class="do">##   &lt;fct&gt;        &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;</span></span>
<span id="cb657-5"><a href="chapter-ggplot2.html#cb657-5" tabindex="-1"></a><span class="do">## 1 Acura        Yes      31   1.8 4    </span></span>
<span id="cb657-6"><a href="chapter-ggplot2.html#cb657-6" tabindex="-1"></a><span class="do">## 2 Acura        Yes      25   3.2 6    </span></span>
<span id="cb657-7"><a href="chapter-ggplot2.html#cb657-7" tabindex="-1"></a><span class="do">## 3 Audi         Yes      26   2.8 6    </span></span>
<span id="cb657-8"><a href="chapter-ggplot2.html#cb657-8" tabindex="-1"></a><span class="do">## # ℹ 90 more rows</span></span></code></pre></div>
<ul>
<li><code>cars_93</code>의 변수 <code>manufacturer</code>와 <code>trans</code>의 자료를 변경해 보자. 우선 <code>manufacturer</code>의 자료 값을 모두 소문자로 변경하고, <code>trans</code>는 자료 값이 <code>Yes</code>이면 <code>manual</code>로, 아니면 <code>auto</code>로 변경하며, 요인 속성은 유지하도록 한다.
변경된 결과는 다음과 같다.</li>
</ul>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="chapter-ggplot2.html#cb658-1" tabindex="-1"></a>cars_93 <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb658-2"><a href="chapter-ggplot2.html#cb658-2" tabindex="-1"></a><span class="do">## # A tibble: 93 × 5</span></span>
<span id="cb658-3"><a href="chapter-ggplot2.html#cb658-3" tabindex="-1"></a><span class="do">##   manufacturer trans    hwy displ cyl  </span></span>
<span id="cb658-4"><a href="chapter-ggplot2.html#cb658-4" tabindex="-1"></a><span class="do">##   &lt;chr&gt;        &lt;fct&gt;  &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;</span></span>
<span id="cb658-5"><a href="chapter-ggplot2.html#cb658-5" tabindex="-1"></a><span class="do">## 1 acura        manual    31   1.8 4    </span></span>
<span id="cb658-6"><a href="chapter-ggplot2.html#cb658-6" tabindex="-1"></a><span class="do">## 2 acura        manual    25   3.2 6    </span></span>
<span id="cb658-7"><a href="chapter-ggplot2.html#cb658-7" tabindex="-1"></a><span class="do">## 3 audi         manual    26   2.8 6    </span></span>
<span id="cb658-8"><a href="chapter-ggplot2.html#cb658-8" tabindex="-1"></a><span class="do">## # ℹ 90 more rows</span></span></code></pre></div>
<ul>
<li><code>cars_93</code>에서 변수 <code>trans</code>와 <code>cyl</code>의 조합에 따른 빈도수를 구하고 다음과 같이 내림차순으로 출력해 보자.</li>
</ul>
<pre><code>## # A tibble: 9 × 3
##   trans  cyl        n
##   &lt;fct&gt;  &lt;fct&gt;  &lt;int&gt;
## 1 manual 4         43
## 2 auto   6         20
## 3 manual 6         11
## 4 auto   4          6
## 5 auto   8          6
## 6 manual 3          3
## 7 manual 5          2
## 8 manual 8          1
## 9 manual rotary     1</code></pre>
<ul>
<li><p>앞 문제의 출력 결과를 보면 <code>trans</code>가 <code>manual</code>이고 <code>cyl</code>이 <code>3</code>, <code>5</code>, <code>8</code>, <code>rotary</code>인 경우에 해당하는 케이스는 제거하는 것이 좋을 것으로 보인다. <code>cars_93</code>에서 해당 케이스를 제거하라.</p></li>
<li><p><code>cars_99</code>의 변수들을 변경해 보자. 변수 <code>trans</code>는 자료 중 <code>auto(l3)</code>, <code>auto(l4)</code>, <code>auto(l5)</code>는 <code>auto</code>로 통합하고, <code>manual(m5)</code>와 <code>manual(m6)</code>는 <code>manual</code>로 통합한다. 또한 <code>hwy</code>와 <code>displ</code>을 제외한 다른 변수는 모두 요인으로 변경한다.
변경된 결과는 다음과 같다.</p></li>
</ul>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="chapter-ggplot2.html#cb660-1" tabindex="-1"></a>cars_99 <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb660-2"><a href="chapter-ggplot2.html#cb660-2" tabindex="-1"></a><span class="do">## # A tibble: 117 × 5</span></span>
<span id="cb660-3"><a href="chapter-ggplot2.html#cb660-3" tabindex="-1"></a><span class="do">##   manufacturer trans    hwy displ cyl  </span></span>
<span id="cb660-4"><a href="chapter-ggplot2.html#cb660-4" tabindex="-1"></a><span class="do">##   &lt;fct&gt;        &lt;fct&gt;  &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;</span></span>
<span id="cb660-5"><a href="chapter-ggplot2.html#cb660-5" tabindex="-1"></a><span class="do">## 1 audi         auto      29   1.8 4    </span></span>
<span id="cb660-6"><a href="chapter-ggplot2.html#cb660-6" tabindex="-1"></a><span class="do">## 2 audi         manual    29   1.8 4    </span></span>
<span id="cb660-7"><a href="chapter-ggplot2.html#cb660-7" tabindex="-1"></a><span class="do">## 3 audi         auto      26   2.8 6    </span></span>
<span id="cb660-8"><a href="chapter-ggplot2.html#cb660-8" tabindex="-1"></a><span class="do">## # ℹ 114 more rows</span></span></code></pre></div>
<ul>
<li><p><code>cars_99</code>의 <code>manufacturer</code>에는 몇 종류의 자동차 회사가 입력되어 있는가?</p></li>
<li><p><code>cars_99</code>의 <code>manufacturer</code>에 입력된 자동차 회사 중 상대도수가 0.1 이상인 회사를 찾아내서 다음과 같이 출력해 보자. 변수 <code>prop</code>에는 상대도수의 계산 결과가 입력되어 있다.</p></li>
</ul>
<pre><code>## # A tibble: 4 × 3
##   manufacturer     n  prop
##   &lt;fct&gt;        &lt;int&gt; &lt;dbl&gt;
## 1 toyota          20  0.2 
## 2 dodge           16  0.16
## 3 volkswagen      16  0.16
## 4 ford            15  0.15</code></pre>
<ul>
<li>두 연속형 변수 <code>displ</code>과 <code>hwy</code>의 관계에서 범주형 변수 <code>cyl</code>이 미치는 영향을 확인하기 위한 그래프를 작성해 보자. 변수 <code>hwy</code>에는 반올림 처리가 된 값을 입력했기 때문에 산점도에서 점이 겹쳐지는 문제를 해결해야 한다.
<code>cars_93</code>에 대해서는 <code>cyl</code>의 그룹별 두 연속형 변수의 산점도를 그림 <a href="chapter-ggplot2.html#fig:ch4-ex4-1">5.69</a>과 같이 작성한다.
또한 <code>cars_99</code>에 대해서는 두 연속형 변수의 산점도 점 모양과 색을 <code>cyl</code>의 값에 다르게 해서 그림 <a href="chapter-ggplot2.html#fig:ch4-ex4-2">5.70</a>과 같이 작성한다.</li>
</ul>
<div class="figure"><span style="display:block;" id="fig:ch4-ex4-1"></span>
<img src="_main_files/figure-html/ch4-ex4-1-1.png" alt="`cars_93`의 세 변수 관계 그래프" width="576" />
<p class="caption">
그림 5.69: <code>cars_93</code>의 세 변수 관계 그래프
</p>
</div>
<div class="figure"><span style="display:block;" id="fig:ch4-ex4-2"></span>
<img src="_main_files/figure-html/ch4-ex4-2-1.png" alt="`cars_99`의 세 변수 관계 그래프" width="576" />
<p class="caption">
그림 5.70: <code>cars_99</code>의 세 변수 관계 그래프
</p>
</div>
<ul>
<li>두 데이터 프레임 <code>cars_93</code>와 <code>cars_99</code>에 있는 변수 <code>displ</code>과 <code>hwy</code>의 관계를 하나의 그래프에 나타내 보자. 변수 <code>displ</code>과 <code>hwy</code>에 대한 회귀직선을 추가한 산점도를 작성하되 각 자료가 속한 데이터 프레임에 따라 점과 직선의 색을 구분하여 다음과 같이 작성해 보자.</li>
</ul>
<div class="figure"><span style="display:block;" id="fig:ch4-ex4-3"></span>
<img src="_main_files/figure-html/ch4-ex4-3-1.png" alt="`cars_93`와 `cars_99`의 `displ`과 `hwy`의 관계 그래프" width="576" />
<p class="caption">
그림 5.71: <code>cars_93</code>와 <code>cars_99</code>의 <code>displ</code>과 <code>hwy</code>의 관계 그래프
</p>
</div>
<ul>
<li>두 데이터 프레임 <code>cars_93</code>와 <code>cars_99</code>에 있는 변수 <code>trans</code>와 <code>hwy</code>의 관계를 나타내는 그래프를 작성해 보자. 변수 <code>trans</code>의 그룹별로 <code>cars_93</code>와 <code>cars_99</code>의 <code>hwy</code>에 대한 상자그림을 다음과 같이 작성해 보자.</li>
</ul>
<div class="figure"><span style="display:block;" id="fig:ch4-ex4-4"></span>
<img src="_main_files/figure-html/ch4-ex4-4-1.png" alt="`cars_93`와 `cars_99`의 `trans`와 `hwy`의  관계 그래프" width="576" />
<p class="caption">
그림 5.72: <code>cars_93</code>와 <code>cars_99</code>의 <code>trans</code>와 <code>hwy</code>의 관계 그래프
</p>
</div>
<p><strong>6.</strong> 다음은 Wikipedia에서 우리나라의 2012년 20개 주요 수출품목 자료가 있는 웹 페이지(<a href="https://en.wikipedia.org/wiki/List_of_exports_of_South_Korea" class="uri">https://en.wikipedia.org/wiki/List_of_exports_of_South_Korea</a>) 에 있는 HTML 테이블의 일부분이다.</p>
<div class="float">
<img src="Figure/ch3_ex_3.png" width="300" alt="대한민국 주요 수출품목" />
<div class="figcaption">대한민국 주요 수출품목</div>
</div>
<ul>
<li>HTML 테이블을 R로 불러와 다음과 같이 출력해 보자. 변수 <code>value</code>는 각 품목의 수출액이고, 변수 <code>prop</code>는 각 품목의 수출액이 20개 전체 품목의 총 수출액에서 차지하는 비율을 나타내고 있다. 단, 변환과정에서는 <code>dplyr</code>의 함수들을 사용한다.</li>
</ul>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="chapter-ggplot2.html#cb662-1" tabindex="-1"></a>export</span>
<span id="cb662-2"><a href="chapter-ggplot2.html#cb662-2" tabindex="-1"></a><span class="do">## # A tibble: 20 × 4</span></span>
<span id="cb662-3"><a href="chapter-ggplot2.html#cb662-3" tabindex="-1"></a><span class="do">##     rank item                                  value   prop</span></span>
<span id="cb662-4"><a href="chapter-ggplot2.html#cb662-4" tabindex="-1"></a><span class="do">##    &lt;int&gt; &lt;chr&gt;                                 &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb662-5"><a href="chapter-ggplot2.html#cb662-5" tabindex="-1"></a><span class="do">##  1     1 Refined petroleum                     51540 0.162 </span></span>
<span id="cb662-6"><a href="chapter-ggplot2.html#cb662-6" tabindex="-1"></a><span class="do">##  2     2 Integrated circuits                   49126 0.155 </span></span>
<span id="cb662-7"><a href="chapter-ggplot2.html#cb662-7" tabindex="-1"></a><span class="do">##  3     3 Cars                                  42484 0.134 </span></span>
<span id="cb662-8"><a href="chapter-ggplot2.html#cb662-8" tabindex="-1"></a><span class="do">##  4     4 Passenger and Cargo Ships             29010 0.0914</span></span>
<span id="cb662-9"><a href="chapter-ggplot2.html#cb662-9" tabindex="-1"></a><span class="do">##  5     5 LCDs                                  23978 0.0756</span></span>
<span id="cb662-10"><a href="chapter-ggplot2.html#cb662-10" tabindex="-1"></a><span class="do">##  6     6 Car parts                             20496 0.0646</span></span>
<span id="cb662-11"><a href="chapter-ggplot2.html#cb662-11" tabindex="-1"></a><span class="do">##  7     7 Broadcasting Equipment                15443 0.0487</span></span>
<span id="cb662-12"><a href="chapter-ggplot2.html#cb662-12" tabindex="-1"></a><span class="do">##  8     8 Broadcasting Accessories              10532 0.0332</span></span>
<span id="cb662-13"><a href="chapter-ggplot2.html#cb662-13" tabindex="-1"></a><span class="do">##  9     9 Telephones                            10417 0.0328</span></span>
<span id="cb662-14"><a href="chapter-ggplot2.html#cb662-14" tabindex="-1"></a><span class="do">## 10    10 Cyclic Hydrocarbons                    8791 0.0277</span></span>
<span id="cb662-15"><a href="chapter-ggplot2.html#cb662-15" tabindex="-1"></a><span class="do">## 11    11 Special Purpose Ships                  8117 0.0256</span></span>
<span id="cb662-16"><a href="chapter-ggplot2.html#cb662-16" tabindex="-1"></a><span class="do">## 12    12 Computers                              6340 0.0200</span></span>
<span id="cb662-17"><a href="chapter-ggplot2.html#cb662-17" tabindex="-1"></a><span class="do">## 13    13 Hot-Rolled Iron                        6288 0.0198</span></span>
<span id="cb662-18"><a href="chapter-ggplot2.html#cb662-18" tabindex="-1"></a><span class="do">## 14    14 Coated Flat-Rolled Iron                5654 0.0178</span></span>
<span id="cb662-19"><a href="chapter-ggplot2.html#cb662-19" tabindex="-1"></a><span class="do">## 15    15 Semiconductor devices                  5210 0.0164</span></span>
<span id="cb662-20"><a href="chapter-ggplot2.html#cb662-20" tabindex="-1"></a><span class="do">## 16    16 Large Construction Vehicles            5091 0.0160</span></span>
<span id="cb662-21"><a href="chapter-ggplot2.html#cb662-21" tabindex="-1"></a><span class="do">## 17    17 Polycarboxylic acids                   4833 0.0152</span></span>
<span id="cb662-22"><a href="chapter-ggplot2.html#cb662-22" tabindex="-1"></a><span class="do">## 18    18 Polyacetals                            4743 0.0149</span></span>
<span id="cb662-23"><a href="chapter-ggplot2.html#cb662-23" tabindex="-1"></a><span class="do">## 19    19 Machinery Having Individual Functions  4621 0.0146</span></span>
<span id="cb662-24"><a href="chapter-ggplot2.html#cb662-24" tabindex="-1"></a><span class="do">## 20    20 Tires                                  4614 0.0145</span></span></code></pre></div>
<ul>
<li>각 품목별 수출액을 다음과 같은 형태의 막대그래프로 표현해 보자. 단, 범주 <code>OTHERS</code>는 수출액 비율이 2% 미만인 품목, 즉 변수 <code>prop</code>의 값이 0.02 미만인 품목을 통합한 범주이다.</li>
</ul>
<div class="figure"><span style="display:block;" id="fig:ch4-ex5-1"></span>
<img src="_main_files/figure-html/ch4-ex5-1-1.png" alt="대한민국 주요 수출품목 및 수출액 막대그래프" width="672" />
<p class="caption">
그림 5.73: 대한민국 주요 수출품목 및 수출액 막대그래프
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter-dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ch6.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
